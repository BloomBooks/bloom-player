!function(e){function t(t){for(var o,a,s=t[0],l=t[1],c=t[2],u=0,f=[];u<s.length;u++)a=s[u],r[a]&&f.push(r[a][0]),r[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(d&&d(t);f.length;)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={0:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var d=l;i.push([141,1]),n()}({0:function(e,t,n){var o,r=n(179),i=n(180),a=(0,n(2).getPlatform)();"ibw-platform-osx-preview"===a||"ibw-platform-win32-preview"===a?(console.log("NoSan"),o={sanitize:function(e){return e},isValidAttribute:function(){return!0}}):o=i(),r.fn.extend({sanitizeHtml:function(e,t){return o.sanitize(e,t)},safeHtml:function(e,t){return null==e?this.html():this.html(this.sanitizeHtml(e,t))},safeAppend:function(e,t){return null==e?this.append(null):this.append(this.sanitizeHtml(e,t))},safeAttr:function(e,t){var n=this.get(0).tagName;return o.isValidAttribute(n,e,t)?this.attr(e,t):this},isSafeURLForNavigation:function(e){return o.isValidAttribute("a","href",e)}}),e.exports=r},102:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceParamsBySessionLink",function(){return a}),n.d(t,"valueOrCacheValue",function(){return s});var o=n(140),r=n.n(o),i=["backbutton","backlink","q"];function a(e){if(""===e)return e;if("undefined"==typeof sessionStorage)return e;var t=e.substring(1).split("&"),n="cache_"+(new Date).getTime()+"_";return"?"+r()(t,function(e){for(var t=0;t<i.length;++t)if(e.startsWith(i[t]+"=")&&!e.startsWith(i[t]+"=cache_")){var o=n+t;return sessionStorage.setItem(o,decodeURIComponent(e.substring(i[t].length+1))),i[t]+"="+o}return e}).join("&")}function s(e){return null==e?e:e.startsWith("cache_")?sessionStorage.getItem(e):e}},119:function(e,t){e.exports={GetItem:function(e){return localStorage.getItem(e)},RemoveItem:function(e){localStorage.removeItem(e)},SetItem:function(e,t){localStorage.setItem(e,t)},Clear:function(){localStorage.clear()}}},12:function(e,t){e.exports=function(){var e={0:"debug",1:"info",2:"error"};function t(t,n,o){return n>=o?function(){!function(t,n,o){var r=Array.prototype.slice.call(o);r.unshift(t+" ("+e[n]+"):"),console.log.apply(console,r)}(t,n,arguments)}:function(){}}return{DEBUG:0,INFO:1,ERROR:2,createLogger:function(e,n){return void 0===n&&(n=1),{debug:t(e,0,n),info:t(e,1,n),error:t(e,2,n)}}}}()},120:function(e,t,n){var o=n(121);e.exports=function(e,t){var r=n(12).createLogger("NativeSQLAsyncKeyStore"),i=new e;i.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var t={};function n(e){var t=String.fromCharCode(29);return(e=e.map(function(e){return e.replace(new RegExp(",","g"),t)})).join()}return t.resultForCallback=function(e,t){i.processCallback(e,t)},t.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.callObjC=function(n,r,a,s){var l=o.url(n,r),c=i.registerCallbacks(a,s),d="'"+c.ok+"'",u="'"+c.error+"'",f="BWKSNativeSQL.resultForCallback";t.runningInIframe()&&(f="function BWKSNativeSQL_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; BWKSNativeSQL_callback_wrapper"),e(l+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+f)},t.getItemsAsync=function(e,o,i){if(0==e.length)return r.error("NativeSQL Error: getItemsAsync without names"),void i({message:"NativeSQL Error: getItemsAsync without names"});t.callObjC("getItemsAsync",{names:n(e)},o,i)},t.getDirAttribs=function(e,n,o){t.callObjC("getDirAttribsAsync",{dirname:e},n,o)},t.setItemsAsync=function(e,n,o){if(0==e.length)return r.error("NativeSQL Error: setItemsAsync without names"),void o({message:"setItemsAsync without names"});if(e.length>1)return r.error("NativeSQL Error: setItemsAsync can only handle 1 item"),void o({message:"setItemsAsync can only handle 1 item"});var i=e[0];t.callObjC("setItemAsync",{keyname:i.key,value:i.value,attribs:i.attribs},n,o)},t.removeItemsAsync=function(e,o,i){if(0==e.length)return r.error("NativeSQL Error: removeItemsAsync without names"),void i({message:"NativeSQL Error: removeItemsAsync without names"});t.callObjC("removeItemsAsync",{names:n(e)},o,i)},t}}(n(70))},121:function(e,t,n){var o=n(69).map;e.exports={url:function(e,t){var n="js2objc://"+e;return t&&(n+="?"+o(t,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")),n}}},122:function(e,t,n){var o,r;e.exports=(o=n(272),n(5),(r=function(e,t,n,r){this.sender=new o(e,"*"),this.useSessionStorage=r,this.token=n}).prototype.postMessage=function(e,t,n){this.token&&(e.token=this.token),this.useSessionStorage&&(e.useSessionStorage=!0),this.sender.send(e,function(e,o){return e?n(e):t(o)})},r.prototype.getItemsAsync=function(e,t,n){this.postMessage({command:"getItems",names:e},t,n)},r.prototype.setItemsAsync=function(e,t,n){this.postMessage({command:"setItems",items:e},t,n)},r.prototype.removeItemsAsync=function(e,t,n){this.postMessage({command:"removeItems",names:e},t,n)},r.prototype.clearAllAsync=function(e,t){this.postMessage({command:"clear"},e,t)},r.prototype.getDirAttribs=function(e,t,n){this.postMessage({command:"getDirAttribs",name:e},t,n)},r)},123:function(e,t,n){var o;e.exports=(o=n(0),function(e,t,n,r){var i=r&&""!==r?"onclick=\"setTimeout(function() { parent.postMessage({ msg:'"+r+"'}, '*');}, 1000);\" ":"",a=document.createElement("iframe");a.className="bwexternallink";var s='<body style="margin: 0px"><a style="display: block; width: 100%; height: 100%; background:red;" '+i+'href="'+t+'" target="_blank">&nbsp;</a></body>';e.appendChild(a),a.contentWindow.document.open(),a.contentWindow.document.write(s),a.contentWindow.document.close(),o(a).css({position:"absolute",left:0,top:0,width:"100%",height:"100%"})})},124:function(e,t,n){e.exports=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e(document.createElement("div")).addClass("bw-throbber-wrapper bw-centering-container").appendTo(t),i=e(document.createElement("canvas")).addClass("bw-throbber bw-centered").attr({width:n,height:n}).appendTo(r),a=i[0].getContext("2d");a.translate(n/2,n/2);for(var s=30*n/100,l=0;l<s;++l){a.rotate(2*-Math.PI/s);var c=o?0:255;a.strokeStyle="rgba("+c+","+c+","+c+","+(1/s).toFixed(2)+")",a.lineWidth=3,a.moveTo(n/5,0),a.lineTo(2*n/5,0),a.stroke()}var d=null,u=!1;return window.requestAnimationFrame(function e(t){if(d||(d=t),!u){var n="rotate("+360*Math.floor(t/1e3*s)/s+"deg)";i.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n}),window.requestAnimationFrame(e)}}),{close:function(){r.remove(),u=!0}}}}(n(0))},13:function(e,t,n){e.exports=function(e,t){function n(n,o,r,i,a){a=a||a+" custom_alert",r=r||e("Ok"),o=o||"Alert",n=n||"No Message to Display";var s=t(document.createElement("div")),l={};return l[r]=function(){t(this).dialog("close"),t(this).remove(),i&&i()},s.safeHtml(n).dialog({title:o,dialogClass:"bw-dialog no-close "+a,resizable:!1,modal:!0,width:"auto",buttons:l}),s}return{showAlert:n,navigateAlert:function(e,o,r,i){var a=n(e,o,r,function(){});return a.parent().find("button").replaceWith(t(document.createElement("a")).safeHtml(r).attr({href:i,target:"_top"}).addClass("ui-button")),a},showCriticalAlert:function(e,o){var r={message:e,title:o};function i(){n(r.message,r.title)}0===t("#critical-alert-button").length&&t(document.createElement("div")).attr("id","critical-alert-button").addClass("bw-toolbutton").append(t(document.createElement("div")).addClass("bw-icon bw-icon-critical-error")).prependTo(t("#title-toolbar")).click(i),i()},showFatalAlert:function(e,n){t(document.createElement("div")).safeHtml(e).dialog({title:n,dialogClass:"bw-dialog no-close",resizable:!1,modal:!0,width:"auto"})},showConfirmationDialog:function(e,n,o,r,i,a){n||(n="Please confirm"),e||(e=""),i||(i="OK"),a||(a="Cancel"),t("#BwConfirmationDalog").remove();var s=t(document.createElement("div")).attr("id","BwConfirmationDialog"),l={};return l[i]=function(){t(this).dialog("close"),t(this).remove(),o&&o()},l[a]=function(){t(this).dialog("close"),t(this).remove(),r&&r()},s.safeHtml(e).dialog({title:n,dialogClass:"bw-dialog BwConfirmationDialog no-close",resizable:!1,modal:!0,width:500,buttons:l}),s},showInfoMessage:function(e){console.log("ShowInfoMessage");var n=t(document.createElement("div"));function o(){n.removeClass("bw-dialog-animate-in").addClass("bw-dialog-animate-out"),setTimeout(function(){n.remove()},500)}n.safeHtml(e).addClass("bw-dialog bw-info-dialog bw-dialog-animate-in").click(function(e){e.stopPropagation(),o()}).appendTo(t("body")),setTimeout(o,1e4)}}}(n(6),n(0))},138:function(e,t,n){e.exports=function(e){var t={},n=function(e){return e<10?"0"+e:""+e};function o(e){var t=Array.prototype.slice.call(arguments,1);try{e&&e.apply(null,t)}catch(e){console.log("Received error when executing callback: "+e)}}return t.getDateTime=function(){var e=new Date;return n(e.getFullYear())+"-"+n(1+e.getMonth())+"-"+n(e.getDate())+" "+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())},t.error=function(e,t){return{code:e,message:t}},t.trimLeadingSlash=function(e){return e.length>0&&"/"==e[0]?e.substr(1):e},t.newCallbackQueue=function(){var e={executeList:[],executing:!1,executeNext:function(){e.executeList.length>0?(e.executing=!0,e.executeList.shift().cb(e.executeNext)):e.executing=!1},executeSequential:function(t,n){if(null!=n&&!1!==n&&null!=n&&e.executeList.length>0)for(var o=0;o<e.executeList.length;++o)e.executeList[o].tag==n&&e.executeList.splice(o,1);e.executeList.push({cb:t,tag:n}),e.executing||e.executeNext()}};return e},t.callSafe=o,t.handleException=function(n,r,i){18==n.code?o(r,t.error(e.BWDS_ERROR_SECURITY,"AsyncBWDS Security Error: problem when accessing: "+JSON.stringify(n))):o(r,t.error(e.BWDS_ERROR_INTERNAL,"AsyncBWDS Error: problem when accessing: "+JSON.stringify(n))),i&&i()},t}(n(32))},139:function(e,t,n){var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(25).o,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(325).o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(74).o;return{createWidgetStorage:function(n,i,a,s,l,c,d,u,f,g,p){var h={};return h.os=o.createWidgetStorage(i,a,s,l,u,f,g,p),h.bs=r.createWidgetStorage(n,i,s,l,t.getUserId(),d,!1),h.loadAll=function(t){var n=e.Deferred(),o=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){o.resolve(e)});var r=this;e.when(n,o).done(function(e,n){var o=e[0],i=e[1];-1==i?(console.log("error accessing online data, return local data or null"),n.hasdata?r.bs.loadAll(t):t(l?null:{})):!1===n.offlinedata||n.version<i?r.bs.overwriteAndSetVersion(o,i).always(function(){t(o)}):r.bs.loadAll(function(e){r.os.overwrite(e,function(n){r.bs.setVersion(n.version).always(function(){t(e)})})})})},h.goneOnlineSync=function(t){var n=e.Deferred(),o=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){o.resolve(e)});var r=this;e.when(n,o).done(function(e,n){var o=e[0],i=e[1];-1==i?console.log("goneOnlineSync: Can't find online version"):n.version<i?(console.log("goneOnlineSync: local version out of date, need to use online version"),r.bs.overwriteAndSetVersion(o,i).always(function(){t({status:"CONFLICT",data:o})})):!0===n.offlinedata?(console.log("goneOnlineSync: latest version is local, pushing state online"),r.bs.loadAll(function(e){r.os.overwrite(e,function(e){r.bs.setVersion(e.version).always(function(){t({status:"OK"})})})})):t({status:"OK"})})},h.write=function(e,t){var n=this;n.bs.write(e,function(){n.os.write(e,function(e){void 0!==e&&e.hasOwnProperty("data")?n.bs.overwriteAndSetVersion(e.data,e.version).always(function(){t(e)}):t(e)})})},h.writeImage=function(t,n){var o=e.Deferred(),r=this;return r.bs.writeImage(t,n).done(function(){o.resolve(),r.os.writeImage(t,n).done(function(){r.bs.setImageBackedUp(t)}).fail(function(){})}).fail(function(){r.os.writeImage(t,n).done(function(){o.resolve()}).fail(function(){o.reject()})}),o},h.clearImage=function(t){var n=e.Deferred();return e.when(this.bs.clearImage(t),this.os.clearImage(t)).done(function(){n.resolve()}).fail(function(){n.reject()}),n},h.readImage=function(t){var n=e.Deferred(),o=this;return o.bs.readImage(t).done(function(e){n.resolve(e)}).fail(function(){o.os.readImage(t).done(function(e){n.resolve(e)}).fail(function(){n.reject()})}),n},h.moveImageOnline=function(t){var n=e.Deferred(),o=this;return o.bs.readImage(t).done(function(e){o.os.writeImage(t,e).done(function(){o.bs.setImageBackedUp(t),n.resolve()}).fail(function(){n.reject()})}).fail(function(){n.reject()}),n},h.moveImageOnlineIfRequired=function(){var t=e.Deferred(),n=this;return n.bs.listImagesAndBackupStatus().done(function(e){for(var o=0;o<e.length;++o)if(!1===e[o].backed_up)return void n.moveImageOnline(e[o].id).done(function(){t.resolve(!0)}).fail(function(){t.reject()});t.resolve(!1)}),t},h},createInfoStorage:function(e,n,o){var i={};return i.bs=r.createInfoStorage(e,t.getUserId(),!1),i.getCommonProperties=function(e){this.bs.getCommonProperties(function(t){e(t)})},i.getGroupProperties=function(e){this.bs.getGroupProperties(function(t){e(t)})},i.setCommonProperties=function(e){this.bs.setCommonProperties(e)},i.setGroupProperties=function(e){this.bs.setGroupProperties(e)},i}}}.bind(null,n(0));e.exports={f:o,o:o()}},141:function(e,t,n){n(142);var o,r,i,a,s,l,c,d,u,f,g,p,h,m,v=n(177).genHtmlCrosswordTable;e.exports=(o=n(4),r=n(185).o,i=n(329),a=n(46),s=n(0),l=n(2),c=n(72),d=n(13),u=n(6),f=n(331),g=n(81),p=n(332),h=n(333),m=new g,void s(function(){o.getConfig().then(function(e){function t(){return"block"===s("#mobile").css("display")}function n(){return"block"===s("#mobilelandscape").css("display")}"right-to-left"===e.direction&&s("#bottom-container").css("direction","rtl"),"right-to-left"===e["description-direction"]?s(".description").css("direction","rtl").addClass("rtl"):s(".description").css("direction","ltr"),s(".hint").safeHtml(u("Select horizontal or vertical word...")),a.makeWidget({layout:"title_toolbar_layout",title:e.title,"no-user-select":!0});var o=0;function g(e){for(var t="",n=!0,o=!0,r=m.splitGraphemes(e.word),i=0;i<r.length;++i){var a=parseInt(e.x),l=parseInt(e.y);"V"==e.dir?l+=i:a+=i;var c=s("#B_"+a+"_"+l),d=c.safeHtml();c.hasClass("filled")||(d="_",n=!1),c.hasClass("correct")||(o=!1),t+=d}return{answer:t,answered:n,correct:o}}var w=s("#bottom-container"),b=s("#hwords"),_=s("#vwords"),y=s("#crossword"),S=h(),k={countLogger:S.registerQuantity("count",u("Answers"),0),correctLogger:S.registerQuantity("correct",u("Correct answers"),0),wrongLogger:S.registerQuantity("wrong",u("Wrong answers"),0),update:function(){var t=s(".box").length,n=s(".box.filled").length;S.setProgress(n,t);var o=function(){for(var t=0,n=0,o=0,r=0;r<e.words.length;++r){var i=g(e.words[r]);i.answered&&(++t,i.correct?++n:++o)}return{answered:t,correct:n,wrong:o}}();this.countLogger.update(o.answered),this.correctLogger.update(o.correct),this.wrongLogger.update(o.wrong)}};function C(){s(".blink").removeClass("blink")}function E(e){C(),s(e[o]).addClass("blink")}function I(){function e(){var e=function(){var e=s(".box.selected");e.sort(function(e,t){return parseInt(s(e).css("left"))+parseInt(s(e).css("top"))-(parseInt(s(t).css("left"))+parseInt(s(t).css("top")))});var t=s(e[0]),n=s(e[e.length-1]),o=t.position(),r=n.position();return o&&r?{left:parseInt(o.left)-11,top:parseInt(o.top)-3,right:parseInt(r.left)+n.width(),bottom:parseInt(r.top)+n.height()}:null}(),t=y.position();if(e&&t){var n=w.innerHeight(),o=w.innerWidth();if(e.top<-t.top||e.left<-t.left||e.bottom>-t.top+n||e.right>-t.left+o){var r=t;e.bottom>-r.top+n&&(r.top=n-e.bottom-10),e.top<-r.top&&(r.top=10-e.top),e.right>-r.left+o&&(r.left=o-e.right-10),e.left<-r.left&&(r.left=10-e.left),y.css(r)}}}e(),setTimeout(e,100)}function O(e){U(),k.update(),s("#textedit").off("change focusout",O),D()}function x(){o=0;var e=s("#textedit"),t=s(".box.selected");if(0!=t.length){t.sort(function(e,t){return parseInt(s(e).css("left"))+parseInt(s(e).css("top"))-(parseInt(s(t).css("left"))+parseInt(s(t).css("top")))}),E(t);var n=t.position();n&&(e.css("left",parseInt(n.left-11)+"px"),e.css("top",parseInt(n.top-3)+"px"),e.show(),e.val(""),e.focus(),e.on("change focusout",O))}}function T(e){y.hasClass("hide")||(s("[V='"+e+"']").addClass("selected"),I(),x(),s("#worddescription span").text(s(".worddesc.selected").text()),s("#worddescription").addClass("show"),s("#worddescription span").addClass("description selected"))}function A(e){y.hasClass("hide")||(s("[H='"+e+"']").addClass("selected"),I(),x(),s("#worddescription span").text(s(".worddesc.selected").text()),s("#worddescription").addClass("show"),s("#worddescription span").addClass("description selected"))}function D(){var e;s(".selected").removeClass("selected"),s(".unclear").removeClass("unclear"),s(".h").removeClass("h"),s("#container").removeClass("show-hint"),s("#worddescription").removeClass("show"),C(),e=s("#textedit"),s("#textedit").blur(),e.hide()}function N(){s("#wordbutton").hasClass("bw-selected")?s("#container").addClass("show-descriptions"):s("#container").removeClass("show-descriptions")}function L(e){e.safeHtml().toLowerCase()===e.data("letter").toLowerCase()?e.addClass("correct"):e.removeClass("correct"),""!=e.safeHtml()?e.addClass("filled"):e.removeClass("filled")}function R(){0==s(".box:not(.filled)").length&&y.addClass("alldone")}function P(){var t=s(".box.selected");return"right-to-left"===e.direction?t.sort(function(e,t){return parseInt(s(e).css("right"))+parseInt(s(e).css("top"))-(parseInt(s(t).css("right"))+parseInt(s(t).css("top")))}):t.sort(function(e,t){return parseInt(s(e).css("left"))+parseInt(s(e).css("top"))-(parseInt(s(t).css("left"))+parseInt(s(t).css("top")))}),t}function B(e){var t=P();if(!(o>=t.length)){var n=s(t[o]);n.safeHtml(e),L(n),++o,E(t)}}function W(){if(0!=o){--o;var e=P();s(e[o]).safeHtml(""),E(e)}}function U(){if("yes"===e.save_answers){var t={};s(".box").each(function(){var e=s(this);t[e.attr("id")]=e.safeHtml()}),r.write(JSON.stringify(t))}}function F(e){for(;o>0;)W();for(var t=m.splitGraphemes(e),n=0;n<t.length;++n)B(t[n]);R()}var M=!0,j=!1;s("#textedit").bind("input",function(e){M=!1,F(s("#textedit").val())});var H="";s("#textedit").bind("keypress",function(e){H=e.altKey||e.ctrKey||e.metaKey?"":String.fromCharCode(e.charCode)}),s("#textedit").bind("keyup",function(e){var t=(void 0!==e?e:event).keyCode;if(13===t&&D(),M&&l.isIOS()&&(console.log("Switching to iOS bug mode"),j=!0),j){var n=s("#textedit").val();8===t?(console.log("iOS bug mode backspace"),s("#textedit").val(n.substring(0,n.length-1))):(console.log("iOS bug mode add letter: "+H),n+=H,s("#textedit").val(n),F(n))}});var V=s(document.createElement("div")).append(s(document.createElement("b")).safeHtml(u("Down"))).appendTo(_),z=[],q=s(document.createElement("div")).append(s(document.createElement("b")).safeHtml(u("Across"))).appendTo(b),K=[],J=0,Q=0;if(t())var G=28,$=28;else n()?(G=20,$=20):(G=33,$=33);var Y=0,X=e.words||[];function Z(t,n){s("#shadow").remove();for(var o=[],r=0;r<X.length;++r)for(var i=e.words[r],a=m.splitGraphemes(i.word),l=0;l<a.length;++l){var c,d=parseInt(i.x),u=parseInt(i.y);"V"==i.dir?u+=l:d+=l,c="right-to-left"===e.direction?'<rect x="'+(J-t*(d+1))+'" y="'+n*u+'" width="'+t+'" height="'+n+'"/>':'<rect x="'+t*d+'" y="'+n*u+'" width="'+t+'" height="'+n+'"/>',o.push(c)}y.prepend('<svg id="shadow" xmlns="http://www.w3.org/2000/svg" version="1.1">'+o.join("")+'"')}function ee(){var e=function(){var e=0,t=s(".box"),n=t.css("font-size"),o=t.css("font-family"),r=p(o,n);return t.each(function(){var t=s(this).data("letter"),n=r.measure(t);e=Math.max(n,e)}),r.destroy(),e}(),t=s(".box, .nbox");t.css("width",null);var n=t.width();e>n&&t.css("width",e);var o=Math.max(e,n)+1,r=t.height()+1;t.each(function(){var e=s(this),t=e.attr("id").split("_");e.css({top:parseInt(t[2])*r,left:parseInt(t[1])*o})}),Z(o,r)}function te(e,t,n){var o=e.data("size"),r={width:e.width(),height:e.height()};if(t&&o){var i=e.offset(),a=i,s=i.left,l=t.width-i.left-o.width;s>l&&l<50&&(a.left=Math.max(0,Math.min(i.left+n.width-t.width,n.width-o.width)));var c=i.top,d=t.height-i.top-o.height;c>d&&d<50&&(a.top=Math.max(0,Math.min(i.top+n.height-t.height,n.height-o.height))),e.offset(a)}e.data("size",r)}0==X.length&&s("#emptywordlist").show();var ne=null,oe=null;function re(){a.centerTitle(!0),ee();var e={height:w.innerHeight(),width:w.innerWidth()},o=t()||n();!o&&!oe&&ne&&ne.width>0&&ne.height>0?(function(e,t,n){var o=e.data("size"),r={width:e.width(),height:e.height()};if(t&&o&&t.width>0&&t.height>0){var i=e.offset(),a={left:i.left+o.width/2,top:i.top+o.height/2},s={left:a.left/t.width*n.width,top:a.top/t.height*n.height},l={left:s.left-r.width/2,top:s.top-r.height/2};e.offset(l)}e.data("size",r)}(y,ne,e),te(_,ne,e),te(b,ne,e)):(we(),be()),ne=e,oe=o}for(var ie=0;ie<X.length;++ie){for(var ae=X[ie],se=m.splitGraphemes(ae.word),le=0;le<se.length;++le){var ce=parseInt(ae.x),de=parseInt(ae.y);"V"==ae.dir?de+=le:ce+=le;var ue="B_"+ce+"_"+de,fe=s("#"+ue);0==fe.length&&(fe=s(document.createElement("div")).addClass("box").attr("id",ue),"right-to-left"===e.direction?fe.css({top:$*de+"px",right:G*ce+"px"}):fe.css({top:$*de+"px",left:G*ce+"px"}),fe.appendTo(y),fe.clickOnDraggable(function(){C();var e=s(this),t=e.attr("V"),n=e.attr("H");if(D(),t&&n)return s("[V='"+t+"']").addClass("unclear"),s("[H='"+n+"']").addClass("h unclear"),s("#hint").css({left:s(this).position().left+1.3*G+"px",top:s(this).position().top+1.3*$+"px"}),s("#worddescription").removeClass("show"),void s("#container").addClass("show-hint");t&&T(t),n&&A(n)})),fe.attr(ae.dir,ie+1+""),fe.data("letter",se[le]),(de+1)*$>Q&&(Q=(de+1)*$),(ce+1)*G>J&&(J=(ce+1)*G)}var ge,pe="N_"+ae.x+"_"+ae.y,he=s("#"+pe);if(0===he.length?(ge=++Y,he=s(document.createElement("div")).addClass("nbox").attr("id",pe).safeHtml(ge),"right-to-left"===e.direction?he.css({top:$*ae.y+"px",right:G*ae.x+"px"}):he.css({top:$*ae.y+"px",left:G*ae.x+"px"}),he.appendTo(y)):ge=he.safeHtml(),"V"==ae.dir)(me=s(document.createElement("div")).addClass("worddesc").safeHtml(ge+".&nbsp;"+ae.description)).attr("V",ie+1+""),z.push([ge,me]),me.clickOnDraggable(function(){D(),T(s(this).attr("V")),s(".description-active").removeClass("description-active"),_.addClass("description-active"),(t()||n())&&(s("#wordbutton").toggleClass("bw-selected"),N(),T(s(this).attr("V")))});else{var me=s(document.createElement("div")).addClass("worddesc").safeHtml(ge+".&nbsp;"+ae.description).attr("H",ie+1+"");K.push([ge,me]),me.clickOnDraggable(function(){D(),A(s(this).attr("H")),s(".description-active").removeClass("description-active"),b.addClass("description-active"),(t()||n())&&(s("#wordbutton").toggleClass("bw-selected"),N(),A(s(this).attr("H")))})}}for(K.sort(function(e,t){return e[0]-t[0]}),z.sort(function(e,t){return e[0]-t[0]}),ie=0;ie<K.length;++ie)q.append(K[ie][1]);for(ie=0;ie<z.length;++ie)V.append(z[ie][1]);Z(G,$);var ve=10;function we(){_.css({width:"",height:"",left:"",right:""}),b.css({width:"",height:"",left:"",right:""}),t()&&(b.width()>_.width()||(_.width()>b.width()?b.css("width",_.width()):(n(),b.width()>_.width()?_.css("width",b.width()):_.width()>b.width()&&b.css("width",_.width()))));var e=b.outerHeight(),o=_.outerHeight(),r=w.height()-2*ve;e>r&&b.css({height:r}),b.css({top:ve,left:ve}),o>r&&_.css({height:r}),t()?_.css({top:ve,left:ve}):n()?_.css({top:ve,left:ve}):_.css({top:ve,right:ve})}function be(){var o=w.width(),r=w.height()-2*ve;"right-to-left"===e.direction?y.css({right:(o-J)/2+"px"}):y.css({left:(o-J)/2+"px"}),t()?(y.css({top:"30%",width:J+"px",height:Q+"px"}),s("#shadow").attr("width",o),s("#shadow").attr("height",Q)):n()?(y.css({top:"5%",width:J+"px",height:Q+"px"}),s("#shadow").attr("width",J),s("#shadow").attr("height",r)):(y.css({top:(w.height()-Q)/2+"px",width:J+"px",height:Q+"px"}),s("#shadow").attr("width",J),s("#shadow").attr("height",Q))}function _e(){s(".box").safeHtml("").removeClass("filled"),y.removeClass("alldone")}function ye(){_e(),U(),S.restart()}l.isTouchDevice()||(b.draggable(),_.draggable()),y.draggable(),we(),be(),"Color correct/wrong letters when done"===e.correction&&y.addClass("correction"),c.addAllDesignInfo(),s("#clearbutton").click(function(){d.showConfirmationDialog(u("The crossword will be permanently deleted and cannot be recovered. Are you sure?"),u("Clear the crossword and start over?"),ye,null,u("Yes, clear"),u("No, keep"))}),window.widget||(window.widget=[]),r.init({type:"Crossword",group:""==e.book_title?"_no_name_":e.book_title,name:e.title,id:e.uuid2,updateCallback:function(t){if(_e(),"yes"===e.save_answers)try{if(null!==t&&""!==t){var n=JSON.parse(t);for(var o in n)if(n.hasOwnProperty(o)){var r=s("#"+o);r.length>0&&(r.safeHtml(n[o]),L(r))}R()}}catch(e){console.error("Caught error loading crossword data: "+t),console.error(e)}},singleKey:!0,extension:".Crossword"}),f({config:e,defaultName:"Crossword",getAnswers:function(t){for(var n=[],o=[],r=0,i=X.length,a=0;a<X.length;++a){var l=e.words[a],c=g(l);n.push(a+1+". "+l.description+": "+c.answer),t?c.answered?c.correct?(o.push(1),++r):o.push(0):o.push(-1):o.push(-2)}var d=v(function(e,t){var n=s("#B_"+e+"_"+t);return 0===n.length?null:{letter:n.text(),correct:n.hasClass("correct")}},X,t);return[{answer:n,question:e.title,annotatedtable:d,score:r,outof:i,correctness:o}]},submitSuccessMessage:u("Your crossword was sent successfully!"),submitFailedTitle:u("Crossword could not be sent."),submitFailedMessage:u("Unable to send crossword. Make sure you're connected to the internet."),sendDialogMessage:u("Complete the form and click send to submit your crossword to your teacher."),shareDialogMessage:u("Complete the form and click send to email your crossword.")},i,d),a.centerTitle(),window.onresize=re,re(),s("#wordbutton").click(function(){s("#wordbutton").toggleClass("bw-selected"),N(),D()})})}))},142:function(e,t,n){"use strict";n.r(t);n(143),n(168),n(170),n(174),n(176)},177:function(e,t,n){"use strict";n.r(t),n.d(t,"genHtmlCrosswordTable",function(){return i});var o=n(81),r=n.n(o);function i(e,t,n){for(var o=new r.a,i=0,a=0,s=0;s<t.length;++s){var l=t[s],c=o.splitGraphemes(l.word),d=parseInt(l.x),u=parseInt(l.y);"V"===l.dir?u+=c.length-1:d+=c.length-1,d>i&&(i=d),u>a&&(a=u)}for(var f=[],g=0;g<a+1;++g){for(var p=[],h=0;h<i+1;++h){var m=e(h,g);if(null==m)p.push('<td style="border: none; width: 15px ; height: 15px">&nbsp;</td>');else{var v=""===m.letter?"&nbsp;":m.letter,w="black";n&&""!==m.letter&&(w=m.correct?"green":"red"),p.push('<td style="border: 1px solid black; width: 15px ; height: 15px ; text-align: center; color:'+w+'">'+v+"</td>")}}f.push("<tr>"+p.join("")+"</tr>")}return"<table>"+f.join("")+"</table>"}},178:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n(5),i=n(181),a=i.loadJS,s=i.loadCSS,l=!1,c=!1,d=new RegExp("https://www.bookwidgets.com/create/api/widgets/[0-9]+/preview/config.(css||js)?");function u(e){return 0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets"+e:window.location.host.startsWith("widgets-eu.")?0===e.search(d)?e:window.location.host.replace("widgets-eu.","//widget-assets-eu.")+e:e}t.default=function(){var e=r.split(window.location.search.substring(1));e.dbg5&&n(182)({apiKey:e.dbg5,autoCaptureSessions:!1,notifyReleaseStages:["production"],releaseStage:"production"});var t=o.Deferred();if(!1===c&&!1===l){l=!0;var i=u(e.content)||"config.js",d=u(e.design)||"config.css";o.when(a(i),s(d)).fail(function(){t.reject(new Error("Unable to load config file"))}).always(function(e,n){n&&o(n).attr("id","designconfig"),l=!1,c=!1;var r=window.widgetconfig;t.resolve(r),-1===navigator.userAgent.indexOf("ibookwidgets")&&(window.widgetconfig=void 0)})}return t}},179:function(e,t){e.exports=window.$},181:function(e,t,n){var o=n(0);e.exports={loadJS:function(e,t,n){var r=o.Deferred(),i=document.createElement("script");if(i.setAttribute("type","text/javascript"),n){var a=!0,s=!1,l=void 0;try{for(var c,d=n[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var u=c.value;i.setAttribute(u,n[u])}}catch(e){s=!0,l=e}finally{try{a||null==d.return||d.return()}finally{if(s)throw l}}}return i.onload=function(){r.resolve()},i.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),r.reject()},i.setAttribute("src",e),document.getElementsByTagName(t||"head")[0].appendChild(i),r},loadCSS:function(e,t){var n=o.Deferred(),r=document.createElement("link");return r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.onload=function(){n.resolve(r)},r.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),n.reject()},r.setAttribute("href",e),document.getElementsByTagName(t||"head")[0].appendChild(r),n}}},184:function(e,t,n){e.exports=function(e){var t=[];window.activateDesignInfoTooltips=function(){console.log("activateDesignInfoTooltips");var n=!0;e.each(t,function(t,o){var r=e(o[0]),i="n";r.height()>700?i=r.offset()&&r.offset().left>800?"e":"w":r.offset()&&r.offset().top>700&&(i="s"),r.attr("data-tipsy",o[1]).tipsy({html:!0,title:"data-tipsy",gravity:i}),e(o[0]).click(function(e){void 0!==window.previewsidebar&&n&&(window.previewsidebar.setSelectedItem(o[1]),n=!1,setTimeout(function(){n=!0},100))})})};var n=[],o=!1;var r=!1;window.BwNotifyWidgetLoaded=function(){r||(r=!0,window.parent.postMessage("BwWidgetLoaded","*"),window.clientApp&&window.clientApp.widgetLoaded&&window.clientApp.widgetLoaded())};var i=!0;function a(){for(;n.length>0;){n.shift()()}i&&window.BwNotifyWidgetLoaded()}return window.BwUseManualWidgetLoadedNotification=function(){i=!1},function(r){if("bwshortcode"in r&&(window.bwshortcode=r.bwshortcode),"pre"in r&&(console.log("Preview"),"designinfo"in r)){console.log("With design info");for(var i=0;i<r.designinfo.length;++i)s=r.designinfo[i].s,l=r.designinfo[i].d,t.push([s,l]);"undefined"!=typeof previewsidebar&&(console.log("Previewsidebar is defined, immediately set design config"),e(function(){var e;e=function(){window.CssUpdateCounter&&(console.log("has CssUpdateCounter -> updating configCss"),window.updateConfigCSS(window.CssUpdateCounter)),console.log("Activating tooltips"),setTimeout(function(){window.activateDesignInfoTooltips()},3e3)},o?setTimeout(e,0):n.push(e)}))}var s,l;if("bra"in r&&e(function(){"iPad"===navigator.platform&&-1!==navigator.userAgent.indexOf("BookWidgets")||e(document.createElement("div")).addClass("branding").appendTo("body")}),"tri"in r&&e(function(){if("iPad"===navigator.platform||-1===navigator.userAgent.indexOf("BookWidgets")&&-1===navigator.userAgent.indexOf("ibookwidgets")){e(document.createElement("div")).addClass("dialog-sheet").attr("id","preview_alert").css({color:"red","text-shadow":"none"}).append(e(document.createElement("p")).safeHtml("This is a free preview widget, created using a trial version of BookWidgets. <b>This widget may only be used for demonstration and evaluation purposes!</b>")).append(e(document.createElement("p")).text("Please purchase a license key for the BookWidgets tool to remove this message.")).appendTo("body");var t=e(document.createElement("div")).addClass("dialog-sheet-shadow");e(document.body).append(t),window.CreateDialogSheetFor("#preview_alert"),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},2e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},6e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},3e4),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},34e3)}}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),window.getWidgetUrl=function(){return window.location.href},window.bwbackbuttonlabel=null,"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var c=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(c=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-c}}return r.hasOwnProperty("backbutton_label")&&""!==r.backbutton_label&&(window.bwbackbuttonlabel=r.backbutton_label),"Vertical"===r.widget_orientation?e("html").addClass("vertical"):e("html").addClass("horizontal"),null!=r.widget_language&&""!==r.widget_language&&e("html").attr("lang",r.widget_language),r.hasOwnProperty("LocalizationMap")&&(window.bwlocalizationmap=r.LocalizationMap),setTimeout(a,0),null}}(n(0))},185:function(e,t,n){var o=function(e,t,o,r){var i,a,s,l,c,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(4),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(25).o,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(74).o,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(139).o,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n(327),h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:n(124),m={},v="",w=!1,b=t.getParameters(),_=b.hasOwnProperty("teacher_id")?b.teacher_id:"",y=b.hasOwnProperty("school_id")?b.school_id:"",S=b.hasOwnProperty("course_id")?b.course_id:"",k=b.hasOwnProperty("class_id")?b.class_id:"";m.WIDGET_ANONYMOUS=0,m.WIDGET_OFFLINE=1,m.WIDGET_ONLINE=2;var C=null,E=-1,I=!1;function O(){E!==m.WIDGET_ONLINE||I||C.moveImageOnlineIfRequired().done(function(e){e&&O()})}function x(){var t=h("body"),n=e.Deferred();return p.start(),C.loadAll(function(e){p.end(),t.close(),i(e),O(),n.resolve()}),n}m.stateChanged=function(t,n){if(t===E&&n===I)return console.log("Warning: setting identical storage state, ignoring"),e.when();if(E===m.WIDGET_OFFLINE&&t===m.WIDGET_ONLINE&&!0===n)return E=t,I=n,e.when();var o="no"!==d.getConfigSync().save_answers;switch(t){case m.WIDGET_ANONYMOUS:console.log("Using anonymous storage"),C=f.createWidgetStorage(s,a,c,w,"",v,o);break;case m.WIDGET_ONLINE:if(!1===n){console.log("Using online storage"),C=g.createWidgetStorage(s,a,l,c,w,u.getUserId(),v,_,y,S,null==k||""===k?u.getUserClassName()?u.getUserClassName():"":k);break}case m.WIDGET_OFFLINE:console.log("Using offline storage"),C=f.createWidgetStorage(s,a,c,w,u.getUserId(),v,o)}var r,h=E,b=I;return E=t,I=n,function(e,t){return-1!=e&&e+t<3}(h,t)?x():h===m.WIDGET_OFFLINE&&t===m.WIDGET_ONLINE?(r=e.Deferred(),p.start(),C.goneOnlineSync(function(e){p.end(),"CONFLICT"==e.status&&i(e.data),O(),r.resolve()}),r):h===m.WIDGET_ONLINE&&t===m.WIDGET_OFFLINE||b!==I?function(){var t=e.Deferred();C.loadAll(function(e){t.resolve()})}():e.when()},m.init=function(e){var t=this;i=e.updateCallback,a=e.type,s=e.group,l=e.name,c=e.id,w=e.singleKey,v=e.extension,p.init(),u.initialized().then(function(){t.stateChanged(u.getState(),u.getForceOfflineStorage()),x(),u.registerStateChangeCallback(t.stateChanged.bind(t))},function(){t.stateChanged(u.ANONYMOUS,!0),x()});var n=!!e.hide_account;u.isStudentAccountsSupported()&&!n&&o.init()};var T,A=!1,D=!1;return m.write=function(t){null!==C&&(A?function(e){D?T=w?e:function(e,t){var n=e||{};for(var o in t)n[o]=t[o];return n}(T,e):(T=e,D=!0)}(t):r.pushAsyncFunc(function(){return function t(n){var o=e.Deferred();return A=!0,p.start(),C.write(n,function(e){p.end(),e&&"CONFLICT"==e.status&&i(e.data),A=!1,D?(D=!1,t(T).done(function(){o.resolve()})):o.resolve()}),o}(t)}))},m.registerImage=function(t){var n=e.Deferred(),o=(new Date).getTime()+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(5);return C.writeImage(o,t).done(function(){n.resolve("bwimg:"+o)}).fail(function(){n.reject()}),n},m.clearImage=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var o=t.substring(6);C.clearImage(o).done(function(){n.resolve()}).fail(function(){console.log("Could not clear image"),n.reject()})}else n.reject();return n},m.getImageUrl=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var o=t.substring(6);C.readImage(o).done(function(e){n.resolve(e)}).fail(function(){n.reject("")})}else n.resolve(t);return n},m.sync=function(e){r.pushSyncFunc(e)},m.clear=function(){},m.createThrottler=function(e){return{cb:e,maxdelay:arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,timeout:null,trigger:function(){var e=this;null!=this.cb&&null==this.timeout&&(p.start(),this.timeout=setTimeout(function(){e.timeout=null,p.end(),e.cb()},this.maxdelay))}}},m}.bind(null,n(0),n(5),n(328),n(73));e.exports={f:o,o:o()}},2:function(e,t,n){e.exports=function(e){function t(){var e=window.navigator.userAgent,t=e.indexOf("OS ");return(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1?window.Number(e.substr(t+3,3).replace("_",".")):0}function n(){return window.BW_PLATFORM_HACK?window.BW_PLATFORM_HACK:"iPad"===navigator.platform||"iPhone"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-ipad-ibooks-epub":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-ipad-safari":-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-ipad-bookwidgets":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-ipad-ibooks":"ibw-platform-ipad":"MacIntel"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-osx-ibooks-epub":-1!==navigator.userAgent.indexOf("PhantomJS")?"ibw-platform-osx-phantomjs":-1!==navigator.userAgent.indexOf("HeadlessChrome")?"ibw-platform-osx-headlesschrome":-1!==navigator.userAgent.indexOf("ibookwidgets")?"ibw-platform-osx-preview":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-osx-chrome":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-osx-safari":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-osx-firefox":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-osx-ibooks":"ibw-platform-osx":"Win32"===navigator.platform?-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-win32-preview":"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Trident")||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Edge")?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-win32-chrome":"Microsoft Internet Explorer"===navigator.appName?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-win32-firefox":"ibw-platform-win32":"iPad Simulator"===navigator.platform||"iPhone Simulator"===navigator.platform?"ibw-platform-ipad-bookwidgets":-1!==navigator.userAgent.indexOf("Android")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-android-chrome":"ibw-platform-android":-1!==navigator.userAgent.indexOf("CrOS")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-chromebook-chrome":"ibw-platform-chromebook":"ibw-platform-unknown"}return{getPlatform:n,supportsAppFeature:function(e){var t=/BookWidgets\/([0-9]+)\.([0-9]+)\.([0-9]+)/g.exec(navigator.userAgent),n=t&&4===t.length?1e4*parseInt(t[1])+100*parseInt(t[2])+parseInt(t[3]):0;return console.log(e+" "+n),"audiorecording"===e&&n>=20800},isToolPreview:function(){return-1!==this.getPlatform().indexOf("preview")},isWebPreview:function(){return"1"===e.getUrlParams(window.location.href).preview},isPreview:function(){return this.isToolPreview()||this.isWebPreview()},isTopLevelPlay:function(){return"1"===e.getUrlParams(window.location.href).toplevel},usesCredentialProxy:function(){return-1!==window.location.search.substring(1).indexOf("bwds-secure-proxy")},isAndroidIosDevice:function(){var e=n();return 0===e.indexOf("ibw-platform-ipad")||0===e.indexOf("ibw-platform-android")},isTouchDevice:function(){return this.isAndroidIosDevice()||(t=" -webkit- -moz- -o- -ms- ".split(" "),"ontouchstart"in window||(e=["(",t.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(e).matches));var e,t},isIOS:function(){return"iPad"===navigator.platform||"iPhone"===navigator.platform},isInternetExplorer:function(){return-1!==window.navigator.userAgent.indexOf("MSIE ")||/rv:11.0/i.test(window.navigator.userAgent)},getIOSIBooksRestartInfo:function(){return t()>=7?'To close iBooks:<ol style="text-align: left;"><li>Double-click the Home button.</li><li>Swipe left or right until you have located iBooks.</li><li>Swipe the app\'s preview up to close it.</li></ol>':t()>=5?"To close iBooks:<ol style=\"text-align: left;\"><li>Double-click the Home button.</li><li>Touch-and-hold the iBooks icon to put it into 'jiggly mode'.</li><li>Tap the red minus-sign icon that appears at the top left corner of iBooks.</li><li>Click the Home button to exit 'jiggly mode'.</li></ol>":""},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}}}}(n(5))},25:function(e,t,n){var o=n(102).valueOrCacheValue,r=function(e,t,r,i,a,s,l,c,d,u,f){var g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:n(4),p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:n(271)(),h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:n(274),m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:n(124),v={INIT:-1,ANONYMOUS:0,OFFLINE:1,ONLINE:2},w=t.Deferred(),b=t.Deferred();return v.initialized=function(){return w.resolve(),b},g.getConfig().then(function(n){var a=c.getParameters(),l=u.isLTI(),g=a.sso,_=a.login_hint,y=c.getQueryParams(window.location.search).toplevel,S=l&&!y||a.no_logout||g,k=v.INIT,C=!1;v.stateChangeCallbacks=[],v.registerStateChangeCallback=function(e){this.stateChangeCallbacks.push(e)},v.triggerStateChangeCallbacks=function(){for(var e=[],n=0;n<this.stateChangeCallbacks.length;++n)e.push(this.stateChangeCallbacks[n](k,C));return t.when.apply(null,e)},v.onlinecheck_enabled=!1;var E=null,I=2;function O(){return"no"!==n.support_student_account||u.isLTI()||g}function x(e){return e.firstName&&""!=e.firstName&&e.lastName&&""!=e.lastName?e.firstName+" "+e.lastName:e.firstName&&""!=e.firstName?e.firstName:e.lastName&&""!=e.lastName?e.lastName:e.providerHumanID&&""!=e.providerHumanID&&e.providerHumanID!==e.providerID?e.providerHumanID:e.email&&""!=e.email?e.email.substring(0,e.email.indexOf("@")):e.providerID}v.isStudentAccountsSupported=O,v.setCredentials=function(e,t){var n={username:x(e),userid:e.id,email:e.email,providerid:e.providerID,providerhumanid:e.providerHumanID,provider:e.provider,school:t,className:e.className,token:e.token,sid:null,coaccount:e.isCoAccount};d.setCredentials(n),p.setCredentials(d.credentials())},v.clearCredentials=function(){d.clear(),p.setCredentials(d.credentials())},v.loadCredentials=function(){return t.Deferred(function(e){p.getCredentials().done(function(t){null!==t?d.setCredentials(t):d.clear(),e.resolve(d.credentials())}).fail(function(){console.log("credentials load failure"),d.clear(),e.resolve(d.credentials())})}).promise()},v.getStudentInfo=function(e,o){var r=null,i=null;return null!=e&&""!==e?i={Authorization:"BWWAAuthToken "+e}:null!=o&&""!==o&&(r={sid:o}),t.ajax({type:"GET",dataType:"json",data:r,url:n.student_account_server+"/student/GetInfo",headers:i,timeout:1e4})},v.checkIfOnline=function(){if(!this.onlinecheck_enabled)return t.when();var e=t.Deferred(),n=d.getUserToken();return this.getStudentInfo(n,null).done(function(t){console.log("Got back online !"),v.goOnline(),e.resolve()}).fail(function(){e.reject()}),e},v.goOffline=function(t){console.log("goOffline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOffline"),n.setState(v.OFFLINE)})},v.goOnline=function(t){console.log("goOnline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOnline"),n.setState(v.ONLINE)})},v.scheduleOnlineCheck=function(){var e=this;I=Math.min(2*I,20),this.onlinecheck_enabled&&(E=setTimeout(function(){e.checkIfOnline().always(function(){e.scheduleOnlineCheck()})},1e3*I))},v.startOnlineCheck=function(){this.onlinecheck_enabled=!0,I=2,this.scheduleOnlineCheck()},v.stopOnlineCheck=function(){this.onlinecheck_enabled=!1,null!==E&&clearTimeout(E)},v.setState=function(e){return e===k?(console.log("Warning: setting identical storage state, ignoring"),t.when()):(k===v.OFFLINE&&this.stopOnlineCheck(),e===v.OFFLINE&&this.startOnlineCheck(),k=e,this.triggerStateChangeCallbacks())},v.setForceOfflineStorage=function(){return!1===C&&(C=!0),this.triggerStateChangeCallbacks()},v.setUserInfo=function(e,t){console.log("Log in successfull"),this.setCredentials(e,t),this.setState(this.ONLINE)},v.waitForExternalLogin=function(e,o){return o=o||2e3,t.Deferred(function(r){var a=null,s=null;var l=h.createPollingUI(function(){a&&clearTimeout(a),s&&s.abort(),c(),r.reject()});function c(){l.close()}!function l(){a=null;var d={sid:e.sid};console.log("Poll",e.sid),s=t.ajax({type:"GET",dataType:"json",data:d,url:n.student_account_server+"/student/GetInfo",timeout:1e4,success:function(e){s=null,c(),r.resolve(e)},error:function(e,t,n){if(s=null,"abort"!==t)if(401===e.status||0===e.status)try{0===e.status||"authenticating"===JSON.parse(e.responseText).auth.status?a=setTimeout(l,o):(c(),r.reject({msg:i("Authentication error.")}))}catch(e){c(),r.reject({msg:i("Server error when signing in.")})}else c(),r.reject({msg:i("Received error trying to sign in")+" ("+e.status+")"})}})}()}).promise()},v.serverLogin=function(e,o,r){return t.Deferred(function(a){var s={schoolCode:e,username:o,password:r};return t.ajax({type:"POST",data:s,url:n.student_account_server+"/student/Login",timeout:1e4}).done(function(e){a.resolve(e)}).fail(function(e){401==e.status?a.reject({msg:i("Wrong username or password, please try again.")}):a.reject({msg:i("Received error trying to sign in")+" ("+e.status+")"})})}).promise()},v.login=function(e,n,o){var r=this;return t.Deferred(function(t){"oauth"===n||"signup"===o.action?r.waitForExternalLogin(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):"login"===o.action?r.serverLogin(o.school,o.username,o.password).done(function(e){t.resolve(e,o.school)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login action"})}).promise()},v.getLoginCredentials=function(e,n){return t.Deferred(function(t){"oauth"===n?t.resolve(e,n):"bw"===n?h.queryBWCredentials(e).done(function(o){t.resolve(e,n,o)}).fail(function(e){t.reject(e)}):"school"===n?h.querySchoolCredentials(e).done(function(o){t.resolve(e,n,o)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login type: "+n})}).promise()},v.hasSchool=function(){return n.hasOwnProperty("student_account_school")&&n.student_account_school.hasOwnProperty("code")&&null!==n.student_account_school.code&&""!==n.student_account_school.code&&"null"!==n.student_account_school.code},v.selectLoginType=function(e){var n=this;return t.Deferred(function(t){if(e.oauth_links.length>0||!n.hasSchool()){if(g)for(var o=0;o<e.oauth_links.length;++o){var a=e.oauth_links[o];if(a.provider===g)return void r.navigateAlert(i("You need to be signed in to use this widget."),i("Please sign in"),i("OK"),a.url)}h.queryLoginMethod(e).done(function(n){t.resolve(e,n)}).fail(function(e){t.reject(e)})}else t.resolve(e,"school")}).promise()},v.getLoginInfo=function(){var e=a.lfq?c.split(a.lfq):{};e.schoolCode=this.hasSchool()?n.student_account_school.code:"",g?e.providers=g:n.student_account_authrestrict&&"yes"===n.student_account_authrestrict&&(e.providers=(n.student_account_authproviders||[]).join(",")),e.source=function(e){var t=s.getPlatform();return"ibw-platform-ipad-ibooks"===t||"ibw-platform-ipad-ibooks-epub"===t?"ibooks-ios":"ibw-platform-ipad-bookwidgets"===t?s.isPreview()?"bwapp-preview":"bwapp":"ibw-platform-osx-ibooks"===t||"ibw-platform-osx-ibooks-epub"===t?"ibooks-osx":"ibw-platform-osx-preview"===t||"ibw-platform-win32-preview"===t?"bw-preview":"ibw-platform-android-chrome"!==t||e?s.isPreview()?"create-preview":s.isTopLevelPlay()?"play":"embed":"embed"}(!!g),n.kmuserid&&""!=n.kmuserid&&(e.creator=n.kmuserid),"undefined"!=typeof bwshortcode&&(e.widget=bwshortcode),s.isIOS()&&(e.ios="1"),e.q=o(a.q);var r=m("body");return t.Deferred(function(o){t.ajax({type:"GET",dataType:"json",data:e,url:n.student_account_server+"/student/GetLoginForm",timeout:1e4}).done(function(e){r.close(),o.resolve(e)}).fail(function(e){r.close(),400==e.status?o.reject({msg:i("Widget configuration error: school doesn't exist.")}):o.reject({msg:i("Could not connect to server, check your internet connection.")})})}).promise()},v.reportFailure=function(e){return e&&e.hasOwnProperty("msg")?h.showMessage(e.msg,i("Sign in failed")):t.when(!0)},v.requestSignin=function(){var e=this;return t.Deferred(function(t){e.getLoginInfo().then(e.selectLoginType.bind(e)).then(e.getLoginCredentials.bind(e)).then(e.login.bind(e)).then(e.setUserInfo.bind(e)).then(function(){t.resolve(!1)}).fail(function(n){e.reportFailure(n).done(function(e){t.resolve(!e)})})}).promise()},v.showLoginStateInfo=function(){return k===v.OFFLINE?h.queryLogout(i("Offline"),i("You're currently offline and logged in as user:"),this.getUserName(),S):k===v.ONLINE?h.queryLogout(i("Online"),i("You're currently online and logged in as user:"),this.getUserName(),S):t.when()},v.loopLoginUntilOnline=function(e){var t=this;this.requestSignin().done(function(n){k===t.ONLINE?e.resolve():n?t.loopLoginUntilOnline(e):h.showMessage(i("You need to be signed in to use this widget."),i("Please sign in")).done(function(){t.loopLoginUntilOnline(e)})})},v.forceLogin=function(){var e=t.Deferred();return this.loopLoginUntilOnline(e),e},v.setAnonymousOrForceLogin=function(){u.isEmbeddedLTI()?this.loginLTI():"optional"===n.support_student_account?(this.setState(this.ANONYMOUS),b.resolve()):this.forceLogin().done(function(){b.resolve()})},v.initializeWithStoredCredentials=function(e){var t=this,o=e.token,r=e.sid,i=null!=o&&""!==o;if(!1===i&&!1===(null!=r&&""!==r)||O()&&this.hasSchool()&&n.student_account_school.code!==e.school)this.setAnonymousOrForceLogin();else{var a=m("body");t.getStudentInfo(o,r).done(function(n){if(a.close(),g&&!r&&(n.provider!==g||!_||0==_.length||n.providerID!==_&&n.providerHumanID!==_))return console.log("Logged in with incompatible credentials. Re-login."),void t.setAnonymousOrForceLogin();t.setCredentials(n,e.school),t.setState(v.ONLINE),b.resolve()}).fail(function(e){a.close(),console.log("Error getting student info -> either invalid token or wrong connection"),i&&401!==e.status?(t.setState(v.OFFLINE),b.resolve()):t.setAnonymousOrForceLogin()})}},v.loginLTI=function(){var e=m("body"),o=this;t.ajax({type:"POST",data:{lti:c.urlencode(c.getParameters()),url:window.location.protocol+"//"+window.location.host+window.location.pathname,wa:n.WA,id:n.uuid2},headers:f.getAJAXHeaders(),url:n.student_account_server+"/student/Login",timeout:1e4}).then(function(t){e.close(),u.setEmbeddedLTIAuthenticated(),o.setCredentials(t,null),o.setState(v.ONLINE),b.resolve()},function(t){e.close();try{var n=JSON.parse(t.responseText);if("noLTILicense"==n.code)return o.setState(o.ANONYMOUS),void b.reject();if(null!=n.message&&n.message.length>0)return void r.showFatalAlert(n.message,i("Error"))}catch(e){}0===t.readyState?r.showFatalAlert(i("You need an internet connection to access this widget."),i("Error")):r.showFatalAlert(i("Error signing in."),i("Error"))})},v.initialize=function(){var e=this;t(function(){if(!O())return e.setState(e.ANONYMOUS),void b.resolve();var t=a.sid;return t?(console.log("Got SID from params"),history.replaceState("",document.title,window.location.pathname+window.location.search+c.removeQueryStringParameter(c.getHash(),"sid")),void e.initializeWithStoredCredentials({sid:t})):!u.isEmbeddedLTI()||u.isEmbeddedLTIAuthenticated()?!l&&s.isPreview()?(e.setState(e.ANONYMOUS),void b.resolve()):void e.loadCredentials().done(e.initializeWithStoredCredentials.bind(e)):void e.loginLTI()})},w.then(function(){v.initialize()}),v.logout=function(){return this.clearCredentials(),"optional"===n.support_student_account?this.setState(v.ANONYMOUS):(m("body"),window.location.reload(!1)),t.when().promise()},v.requestSignout=function(){return this.showLoginStateInfo().done(this.logout.bind(this))},v.getUserToken=function(){return d.getUserToken()},v.getUserSid=function(){return d.getUserSid()},v.getUserName=function(){return d.getUserName()},v.getUserClassName=function(){return d.getUserClassName()},v.getUserId=function(){return d.getUserId()},v.getEmail=function(){return d.getEmail()},v.getProviderId=function(){return d.getProviderId()},v.getProviderHumanId=function(){return d.getProviderHumanId()},v.isCoAccount=function(){return d.isCoAccount()},v.getState=function(){return k},v.getForceOfflineStorage=function(){return C},v.hasProperty=function(e){return"user_id"===e},v.getProperty=function(e){if("user_id"==e)return this.getUserId()}}),v}.bind(null,n(73),n(0),n(13),n(6),n(123),n(2),n(46),n(5),n(281),n(71),n(282));e.exports={f:r,o:r()}},271:function(e,t,n){e.exports=function(e,t,o,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(2),a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(119),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(120),l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(122);function c(t){this._storage=t,this.setCredentials=function(t){var n=this;return e.Deferred(function(e){n._storage.setItemsAsync([{key:"BwCredentials",value:JSON.stringify(t),attribs:""}],function(){e.resolve()},function(){e.reject()})})},this.getCredentials=function(){var t=this;return e.Deferred(function(e){t._storage.getItemsAsync(["BwCredentials"],function(t){try{var n=JSON.parse(t.BwCredentials.value);e.resolve(n)}catch(t){e.reject()}},function(){e.reject()})})}}var d=o.isLTI()||t.getParameters().sso;return d&&console.log("Using session storage for credentials"),"ibw-platform-ipad-bookwidgets"===i.getPlatform()?new c(new s):i.usesCredentialProxy()?new c(new l("_secureStorage",!0,t.getQueryParams(window.location.search)["bwds-secure-proxy-token"],d)):new function(t){this.setCredentials=function(n){return e.Deferred(function(e){try{t.SetItem("BwCredentials",JSON.stringify(n)),e.resolve()}catch(t){e.reject()}})},this.getCredentials=function(){return e.Deferred(function(e){try{var n=JSON.parse(t.GetItem("BwCredentials"));e.resolve(n)}catch(t){e.reject()}})}}(d?r:a)}.bind(null,n(0),n(5),n(71),n(273))},272:function(e,t,n){var o,r;e.exports=(o=n(70),(r=function(e,t){this.name=e,this.origin=t,this.callbackBridge=new o,this.callbackBridge.startListening()}).prototype.send=function(e,t,n){e.to=this.name,e.cb=this.callbackBridge.registerCallback(t,n),parent.postMessage(e,this.origin)},r)},273:function(e,t){e.exports={GetItem:function(e){return sessionStorage.getItem(e)},RemoveItem:function(e){sessionStorage.removeItem(e)},SetItem:function(e,t){sessionStorage.setItem(e,t)},Clear:function(){sessionStorage.clear()}}},274:function(e,t,n){e.exports=function(e,t,n,o,r,i,a){var s={},l=e.getConfigSync();function c(){var e=i.getPlatform();return!!("ibw-platform-ipad-ibooks"===e||"ibw-platform-ipad-ibooks-epub"===e||"ibw-platform-osx-ibooks"===e||"ibw-platform-osx-ibooks-epub"===e||"ibw-platform-android-chrome"===e||i.isPreview()||"ibw-platform-ipad-bookwidgets"!==e&&!1===i.isTopLevelPlay())}function d(e){for(var t=0;t<e.bw_links.length;++t){var n=e.bw_links[t];if("bw-student"===n.name)return n}return null}function u(){return l.hasOwnProperty("student_account_school")&&l.student_account_school.hasOwnProperty("code")&&null!==l.student_account_school.code&&""!==l.student_account_school.code&&"null"!==l.student_account_school.code}return s.createDialog=function(e,n){var o=t(document.createElement("div")).addClass("bw-login-dialog-wrapper"),i=t(document.createElement("div")).css({position:"absolute",width:"100%",height:"100%",left:"0px",top:"0px"}).appendTo(o),a=t(document.createElement("div")).attr("id","bw-login-dialog").addClass("bw-row-container").appendTo(o);return n&&(o.addClass("bw-centering-container"),a.addClass("bw-centered")),o.appendTo("body"),e&&i.click(function(){o.remove(),e.reject()}),{close:o.remove.bind(o),show:function(e,n){var o;a.empty(),n&&t(document.createElement("div")).addClass("login-dialog-title bw-row-fixed").safeHtml(n).appendTo(a),e.appendTo(a),(o=a).find(".weblink").each(function(){r(t(this).parent()[0],t(this).attr("href"),!0,t(this).attr("message")),t(this).attr("href","")}),o.find(".external-link").each(function(){r(this,t(this).attr("href"),!1,t(this).attr("message")),t(this).attr("href","")})}}},s.queryLoginMethod=function(e){var n=this;return t.Deferred(function(r){var i=n.createDialog(r,!0),a=t(document.createElement("div")).addClass("login-type-selection login-dialog-body");var s,l=d(e),f=null!==l;function g(){removeEventListener("message",p),i.close()}function p(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(g(),r.resolve("oauth"))}e.oauth_links.length>0&&function(n,r){n=e.oauth_links;for(var i=0;i<n.length;++i){var a=n[i],s=c()&&a.toplevel,l=s?" weblink login-type-button":" login-type-button",d=s?"_blank":"_top",u=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";t(document.createElement("div")).addClass("web-link-wrapper"+l).append(t(document.createElement("a")).attr({message:"linkclicked",href:a.url,target:d,onclick:u}).safeHtml(o("Sign in using")+" "+a.name)).appendTo(r)}}(e.oauth_links,a),f&&(u()||(s=a,t(document.createElement("div")).addClass("login-type-button").safeHtml(o("Sign in using email and password")).tapOrClick(function(){r.resolve("bw"),g()}).appendTo(s)),function(e,n){t(document.createElement("div")).addClass("login-type-button").safeHtml(o("Sign in using school account")).tapOrClick(function(){r.resolve("school"),g()}).appendTo(n)}(0,a)),i.show(a,o("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",p)}).promise()},s.queryBWCredentials=function(e){var n=this;return t.Deferred(function(r){var i=n.createDialog(r,!0),a=d(e),s=t(document.createElement("div")).addClass("login-form login-dialog-body");function l(){removeEventListener("message",u),i.close()}function u(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(l(),r.resolve({action:"signup"}))}!function(e,n){var i=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-email",placeholder:o("Email"),tabindex:"1"}).appendTo(n),a=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-password",type:"password",placeholder:o("Password"),tabindex:"2"}).appendTo(n);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","3").safeHtml(o("Sign in")).tapOrClick(function(){r.resolve({action:"login",school:"",username:i.val(),password:a.val()}),l()}).appendTo(n);var s=c(),d=s?" external-link":"",u=s?"_blank":"_top",f=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";e.hasOwnProperty("resetPasswordURL")&&t(document.createElement("a")).attr({href:e.resetPasswordURL,target:u,onclick:f}).safeHtml(o("Forgot password?")).addClass("bw-reset-password"+d).appendTo(n),e.hasOwnProperty("registerURL")&&(t(document.createElement("hr")).appendTo(n),t(document.createElement("p")).css("position","relative").appendSafe("Don't have an account?").append(t(document.createElement("br"))).append(t(document.createElement("a")).attr({message:"linkclicked",href:e.registerURL,target:u,onclick:f}).addClass("bw-signup"+d).safeHtml(o("Sign up here"))).appendTo(n))}(a,s),i.show(s,o("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",u)}).promise()},s.querySchoolCredentials=function(e){var n=this;return t.Deferred(function(e){var r,i=n.createDialog(e,!0),a=t(document.createElement("div")).addClass("login-form login-dialog-body");u()||(r=t(document.createElement("input")).attr({id:"school-school",placeholder:o("School code"),tabindex:"1"}).addClass("login-dialog-field").appendTo(a));var s=t(document.createElement("input")).attr({id:"school-username",placeholder:o("Username"),tabindex:"2"}).addClass("login-dialog-field").appendTo(a),c=t(document.createElement("input")).attr({id:"school-password",type:"password",placeholder:o("Password"),tabindex:"3"}).addClass("login-dialog-field").appendTo(a);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","4").safeHtml(o("Sign in")).tapOrClick(function(){var t=u()?l.student_account_school.code:r.val();e.resolve({action:"login",school:t,username:s.val(),password:c.val()}),i.close()}).appendTo(a),i.show(a,u()?l.student_account_school.name:o("Sign in")),window.postMessage({msg:"requestlogin"},"*")}).promise()},s.queryLogout=function(e,n,r,i){var a=this;return t.Deferred(function(s){var l=a.createDialog(s),c=t(document.createElement("div")).attr("id","offline-dialog").addClass("login-dialog-body");t(document.createElement("p")).safeHtml(n).appendTo(c),t(document.createElement("div")).attr("id","login-current-user").safeHtml(r||"").appendTo(c),i||t(document.createElement("div")).addClass("login-dialog-button").safeHtml(o("Sign out")).tapOrClick(function(){l.close(),s.resolve()}).appendTo(c),l.show(c,e)}).promise()},s.showMessage=function(e,r){return t.Deferred(function(t){n.showAlert(e,r,o("OK"),function(){t.resolve()})})},s.createPollingUI=function(e){var n=this.createDialog(null,!0),r=t(document.createElement("div")).addClass("login-pollingdialog");return t(document.createElement("p")).safeHtml(o("Waiting for account sign in to complete...")).appendTo(r),t(document.createElement("div")).addClass("login-dialog-button").safeHtml(o("Cancel")).tapOrClick(e).appendTo(r),n.show(r,o("Waiting")),n},s}(n(4),n(0),n(13),n(6),n(123),n(2),n(46))},275:function(e,t,n){var o=n(72);e.exports=function(e){window.addEventListener("message",function(t){var n=t.data;"set-css"===n.command&&(!function(t){e("style[id='designconfig'], link[id='designconfig']").remove();var n=document.createElement("style");n.id="designconfig",n.type="text/css",n.appendChild(document.createTextNode(t)),document.head.appendChild(n)}(n.css),o.executeCssUpdateCallbacks())})}(n(0))},276:function(e,t){e.exports=void window.addEventListener("message",function(e){"print"===e.data.command&&window.print()})},277:function(e,t,n){e.exports=function(e,t){return{createLabeledCheckbox:function(t,n,o){var r=e(document.createElement("table")).addClass("bw-checkbox").appendTo(t),i=e(document.createElement("tr")).appendTo(r),a=e(document.createElement("td")).addClass("bw-checkbox-cell").appendTo(i);return e(document.createElement("div")).addClass("bw-checkbox-checkbox bw-icon bw-icon-accept").appendTo(a),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(i),r.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),r.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),r.makeButton({role:"checkbox"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),o&&o.call(t[0],!1)):(t.trigger("check"),o&&o.call(t[0],!0)))}),r.trigger("clear"),r},createProgressBar:function(t,n){var o={};o.parent=t,o.max=n,e(document.createElement("div")).addClass("bw-progress-bar").css("left","-100%").appendTo(e(t));var r=100/n;return e(document.createElement("div")).addClass("bw-progress-bar-marker").css({left:"-100%",width:r+"%"}).appendTo(e(t)),o.setProgress=function(n,o,r){o=o||400;var i=100*-(this.max-parseFloat(n))/this.max,a=e(this.parent+"> .bw-progress-bar"),s=e(t).width(),l=-(this.max-parseFloat(n))*s/this.max;a.css("left",a.css("left")),a.animate({left:l},o,"swing",function(){a.css("left",i+"%"),r&&r()})},o.setPosition=function(n,o){o=o||400;var r=e(this.parent+"> .bw-progress-bar-marker"),i=100*parseFloat(n)/this.max,a=e(t).width()*n/this.max;r.css("left",r.css("left")),r.animate({left:a},o,"swing",function(){r.css("left",i+"%")})},o.clear=function(){e(this.parent+" .bw-progress-bar").css("left","-100%"),e(this.parent+" .bw-progress-bar-marker").css("left","-100%")},o},createSimpleCheckbox:function(t,n,o){var r=e(document.createElement("div")).addClass("bw-simple-checkbox bw-icon bw-icon-accept").appendTo(e(t)),i={role:"checkbox"};return o&&(i.labelledby=o),r.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),r.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),r.makeButton(i).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),r.trigger("clear"),r},createNumberButtons:function(n,o,r,i,a){function s(t){if(e(".buttonslot").removeClass("selected"),o<=9)e("#BS_"+t).addClass("selected");else if(t<5){e("#BS_1").removeClass("hide_number"),e("#BS_7").addClass("hide_number");for(var n=1;n<8;++n)e("#BS_"+n).find(".number-button").safeHtml(n+1);e("#BS_"+t).addClass("selected")}else if(o-t<6){e("#BS_1").addClass("hide_number"),e("#BS_7").removeClass("hide_number");for(var r=2;r<8;++r)e("#BS_"+r).find(".number-button").safeHtml(o-8+r);e("#BS_"+(9-(o-t))).addClass("selected")}else{e("#BS_1").addClass("hide_number"),e("#BS_7").addClass("hide_number");for(var s=1;s<8;++s)e("#BS_"+s).find(".number-button").safeHtml(s+t-3);e("#BS_4").addClass("selected")}0===t?e(i).addClass("hidden"):e(i).removeClass("hidden"),t===o-1?e(a).addClass("hidden"):e(a).removeClass("hidden")}for(var l=0,c=Math.min(o,9),d=e(n),u=0;u<c;++u)e(document.createElement("div")).addClass("buttonslot").attr("id","BS_"+u).append(e(document.createElement("div")).addClass("number-button bw-button").text(u+1)).appendTo(d).find(".number-button").makeButton().tapOrClick(function(){s(l=parseInt(e(this).safeHtml())-1),r(l)});function f(){--l<0&&(l=0),s(l),r(l)}function g(){++l>=o&&(l=o-1),s(l),r(l)}return o>9&&(e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_1")),e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_7")),e("#BS_7").addClass("hide_number"),e("#BS_7").find(".number-button").safeHtml(o-1),e("#BS_8").find(".number-button").safeHtml(o)),e("#BS_0").addClass("selected"),e(i).addClass("hidden"),e(i).makeButton(t("previous")).tapOrClick(f),e(a).makeButton(t("next")).tapOrClick(g),{updateButtons:s,next:g,prev:f}},createSimpleRadiobutton:function(t,n,o){var r=e(document.createElement("div")).addClass("bw-simple-radiobutton bw-icon").appendTo(e(t));r.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),r.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})});var i={role:"radio"};return o&&(i.labelledby=o),r.makeButton(i).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),r.trigger("clear"),r},createLabeledRadiobutton:function(t,n,o){var r=e(document.createElement("table")).addClass("bw-radiobutton").appendTo(t),i=e(document.createElement("tr")).appendTo(r),a=e(document.createElement("td")).addClass("bw-radiobutton-cell").appendTo(i);return e(document.createElement("div")).addClass("bw-radiobutton-radiobutton bw-icon bw-icon-largedot").appendTo(a),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(i),r.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),r.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),r.makeButton({role:"radio"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),o&&o.call(t[0],!1)):(t.trigger("check"),o&&o.call(t[0],!0)))}),r.trigger("clear"),r},createProgressCircle:function(t,n,o){var r={},i=30,a=40,s=40;r.id=n,r.progress=Array(o);var l=e(document.createElement("div")).addClass("bw-progress-circle bw-centering-container").attr("id",n).appendTo(e(t));e(document.createElement("div")).addClass("bw-progress-circle-text bw-centered").appendTo(l);var c=[];function d(e,t){if(-1===e)return"";var n=2*Math.PI*e/o,r=2*Math.PI*(e+1)/o,i=a+Math.sin(n)*t,l=s-Math.cos(n)*t,c=a+Math.sin(r)*t,d=s-Math.cos(r)*t;return"M X1 Y1 A R R 0 0 1 X2 Y2".replace("X1",i).replace("Y1",l).replace("X2",c).replace("Y2",d).replace("D",n).replace("R",t).replace("R",t)}function u(e){return'<path d="'+d(e,i)+'"/>'}for(var f=0;f<o;++f)c.push(u(f));return e('<svg class="bw-progress-circle-drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 80 80">'+c.join("")+'<path class="the marker"/></svg>').appendTo(l),r.setProgress=function(t,n){e("#"+this.id+" path:nth-child("+(t+1)+")").attr("class",n)},r.setTextAndPosition=function(t,n){var o=e("#"+this.id+" .bw-progress-circle-text");o.animate({opacity:0},200,"swing",function(){o.empty().append(t).animate({opacity:1},200)});var r=e("#"+this.id+" path.the.marker");r.animate({opacity:0},200,"swing",function(){r.attr("d",d(n,i)).animate({opacity:1},200)})},r}}}(n(0),n(6))},278:function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return"string"==typeof(t=e)||"object"===n(t)&&t.constructor===String?0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("//")?e.replace(/\(/g,"_").replace(/\)/g,"_").replace(/'/g,"%27"):encodeURIComponent(e).replace(/%2F/g,"/").replace(/'/g,"%27"):"";var t}},279:function(e,t){e.exports=function(e){var t="file:";window&&window.location&&window.location.protocol&&(t=window.location.protocol);var n="";return 0===e.indexOf("http://")?n="http://":0===e.indexOf("https://")?n="https://":0===e.indexOf("//")&&(n="//"),""!==n?"file:"===t?"//"===n?"http:"+e:e:"http:"===t?"//"===n?"http:"+e:e:"https:"===t&&"http://"===n?e.replace("http://","https://"):"//"===n?"https:"+e:e:e}},280:function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r,i,a;e.exports=(r=n(2),i=n(0),-1!==(a=r.getPlatform()).indexOf("android")?i.fn.extend({clickOnDraggable:function(e){return this.each(function(){var t=!1;this.ClickOnDraggableCallback=e,i(this).on("touchstart",function(e){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&1===n.touches.length&&n.changedTouches[1]===n.touches[1]?(t=!0,setTimeout(function(){t&&(console.error("touch takes too long"),t=!1)},100)):t=!1}),i(this).on("touchend",function(e){if(t){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&0===n.touches.length?(t=!1,this.ClickOnDraggableCallback()):t=!1}})})}}):i.fn.extend({clickOnDraggable:function(e){return this.each(function(){i(this).click(e)})}}),-1!==a.indexOf("android")||-1!==a.indexOf("preview")||-1!==a.indexOf("phantomjs")||-1!==a.indexOf("headlesschrome")||-1!==a.indexOf("chrome")||"ibw-platform-osx-safari"===a||"ibw-platform-osx-ibooks"===a||"ibw-platform-osx-ibooks-epub"===a?i.fn.extend({tapOrClick:function(e){return this.each(function(){i(this).click(e);var t=this,n=i(this);n.is("button")||n.is("a")||n.on("keydown",function(n){var o=n.which;13!==o&&32!==o||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){i(this).unbind("click");var e=i(this);e.is("button")||e.is("a")||e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){i(this).trigger("click",e)})}}):i.fn.extend({tapOrClick:function(e){return this.each(function(){var t=this,n=i(this);n.addClass("epub-block"),n.find("*").each(function(){this instanceof SVGElement||i(this).addClass("epub-block")});var o=!1;n.hammer?"ibw-platform-ipad-bookwidgets"===a||"ibw-platform-ipad-ibooks-epub"===a||"ibw-platform-ipad-ibooks"===a?n.hammer().on("tap",function(r){!1===o&&(e.bind(t)(r),o=!0,setTimeout(function(){o=!1},500)),n.blur(),r.stopImmediatePropagation()}):n.hammer().on("tap",function(o){e.bind(t)(o),n.blur(),o.stopImmediatePropagation()}):n.click(function(o){e.bind(t)(o),n.blur()}),(n.hammer||!n.is("button")&&!n.is("a"))&&n.on("keydown",function(n){var o=n.which;13!==o&&32!==o||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){var e=i(this);e.hammer?e.hammer().off("tap"):e.unbind("click"),(e.hammer||!e.is("button")&&!e.is("a"))&&e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){var t=i(this);t.hammer?t.hammer().trigger("tap",e):t.trigger("click",e)})}}),i.fn.extend({clickOrHold:function(e,t,n){return n=n||3e3,this.each(function(){var o=!1,r=null;i(this).click(function(t){o||e.bind(this)(t),o=!1}),i(this).on("keydown",function(t){var n=t.which;13!==n&&32!==n||e.bind(this)({prevent:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})}),i(this).on("mousedown touchstart",function(){var e=this;r=setTimeout(function(){r=null,o=!0,t.bind(e)()},n)}),i(this).on("mouseup touchend",function(){null!==r&&(clearTimeout(r),r=null),o&&setTimeout(function(){o=!1},400)})})}}),void i.fn.extend({makeButton:function(e){"string"==typeof(e=e||{})&&(e={label:e}),this.attr({role:e.hasOwnProperty("role")?e.role:"button"});var t=this.attr("tabindex");return"undefined"!==o(t)&&!1!==t||this.attr({tabindex:"0"}),e.hasOwnProperty("label")&&this.attr({"aria-label":e.label}),e.hasOwnProperty("labelledby")&&this.attr({"aria-labelledby":e.labelledby}),this},makeLink:function(e){return this.attr({role:"link",tabindex:"0"}),e&&this.attr({"aria-label":e}),this}}))},281:function(e,t){var n;e.exports={_creds:n={username:null,userid:null,email:null,providerid:null,providerhumanid:null,provider:null,school:null,token:null,sid:null,coaccount:null},credentials:function(){return this._creds},clear:function(){this._creds=n},setCredentials:function(e){this._creds=e},getUserToken:function(){return this._creds.token},getUserSid:function(){return this._creds.sid},getUserName:function(){return this._creds.username},getUserClassName:function(){return this._creds.className},getUserId:function(){return this._creds.userid},getEmail:function(){return this._creds.email},getProviderId:function(){return this._creds.providerid},getProviderHumanId:function(){return this._creds.providerhumanid},isCoAccount:function(){return this._creds.coaccount}}},282:function(e,t,n){var o;e.exports=(o=n(4).getConfigSync(),{getAJAXHeaders:function(){return null!=o.widget_language&&o.widget_language.length>0?{"Accept-Language":o.widget_language}:{}}})},283:function(e,t,n){var o,r,i,a,s,l,c,d,u,f,g,p,h,m,v,w;e.exports=(o=n(2),r=n(284).o,i=n(285),a=n(286),s=n(120),l=n(122),n(32),c=n(323),u=new(n(324))(r),f=new i,g=new c(f),p=new a,h=new c(p),m=new s,v=new c(m),w=o.getPlatform(),-1!==window.location.search.substring(1).indexOf("bwds-proxy")?(d=new c(new l("_storage")),console.log("BWDS: Proxy")):"ibw-platform-ipad-bookwidgets"===w?(d=v,window.BWKSNativeSQL=m,console.log("BWDS: Native")):"ibw-platform-ipad-ibooks"===w?(console.log("BWDS: IndexedDB"),d=h):"ibw-platform-osx-chrome"!==w&&"ibw-platform-osx-preview"!==w&&"ibw-platform-win32-preview"!==w&&"ibw-platform-win32-chrome"!==w&&"ibw-platform-chromebook-chrome"!==w&&"ibw-platform-android-chrome"!==w||!window.openDatabase?(d=u,console.log("BWDS: Local")):(console.log("BWDS: WebSQL"),d=g),d.test={BWKSIDB:p,BWKSWebSQL:f,BWDSLocal:u,BWDSWebSQL:g},-1!==navigator.userAgent.indexOf("ibookwidgets")&&(window.BWDS=d),d)},284:function(e,t,n){var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(119);function o(e){return"iBookWidgets/"+e}var r=e.createLogger("BWKSLocal");return{getItem:function(e){return r.debug("getItem "+o(e)),t.GetItem(o(e))},setItem:function(e,n){r.debug("setItem "+o(e));try{return t.SetItem(o(e),n),!0}catch(e){return!1}},removeItem:function(e){r.debug("removeItem "+o(e)),t.RemoveItem(o(e))},clear:function(){r.debug("clear"),t.Clear()}}}.bind(null,n(12));e.exports={f:o,o:o()}},285:function(e,t,n){e.exports=function(e){var t=n(12).createLogger("WebSQLAsyncKeyStore");function o(e,n,o){t.error("WebSQL Error: executeSQL triggered error: "+o.message),null!=e&&e(o)}var r=function(e,t){this.name=e||"BWDS1",this.initialized=!1,this.valid=!1,this.db=null,this.openDatabase=void 0!==t?t:window.openDatabase?window.openDatabase.bind(window):function(){console.error("webSQL not supported")}};return r.prototype._prepareDatabase=function(e,n){var o=this.openDatabase(this.name,"","Offline BW storage",5242880);return""==o.version&&(t.debug("WebSQL: creating db"),o.changeVersion(o.version,"1.0",function(e){t.debug("WebSQL: creating table"),e.executeSql("CREATE TABLE keyvalue (keyname PRIMARY KEY, dir, name, value, attribs)")},n)),o},r.prototype._initializeAndRun=function(e,n){if(this.initialized)this.valid?void 0!==e&&e():(t.debug("WebSQL Error: Database is initialized but not valid, calling error"),void 0!==n&&n(this.error));else if(this.initialized=!0,this.openDatabase){try{t.debug("WebSQL: initializing database"),this.db=this._prepareDatabase(function(e){t.debug("WebSQL Error: Received error while preparing database: "+e.message)}),this.valid=!0}catch(e){switch(e.code){case e.SECURITY_ERR:t.debug("WebSQL Error: Received security error: "+e.message);break;case e.INVALID_STATE_ERR:t.debug("WebSQL Error: Received invalid state error: "+e.message);break;default:t.debug("WebSQL Error: Received error "+e.code+": "+e.message)}return this.valid=!1,this.error=e,void n(e)}e()}else t.debug("WebSQL Error: No WebSQL database available"),this.valid=!1,this.error={code:9999,message:"WebSQL Error: No WebSQL database available"},n(this.error)},r.prototype._initializeAndRunTransaction=function(e,n,o){var r=this;this._initializeAndRun(function(){r.db[e?"readTransaction":"transaction"](function(e){try{n(e)}catch(e){t.error("Error while executing transaction: "+e.code+": "+e.message),null!=o&&o(e)}},function(e){t.error("WebSQL Error: "+e.code+" starting transaction :"+e.message),r.valid=!1,r.initialized=!1,null!=o&&o(e)})},function(e){t.error("WebSQL Error: database not valid"),null!=o&&o(e)})},r.prototype._initializeAndRunReadTransaction=function(e,t){this._initializeAndRunTransaction(!0,e,t)},r.prototype._initializeAndRunReadWriteTransaction=function(e,t){this._initializeAndRunTransaction(!1,e,t)},r.prototype.getItemsAsync=function(e,n,r){if(0===e.length)return t.debug("WebSQL Error: getItemsAsync without names"),void r({code:9999,message:"WebSQL Error: getItemsAsync without names"});this._initializeAndRunReadTransaction(function(i){for(var a="",s=0;s<e.length;++s)a+=(""==a?"":", ")+"?";i.executeSql("SELECT keyname, value, attribs FROM keyvalue where keyname IN ("+a+")",e,function(e,o){for(var r={},i=0;i<o.rows.length;++i){var a=o.rows.item(i);r[a.keyname]=a,t.debug("WebSQL: read ("+a.keyname+") = "+a.value)}n(r)},o.bind(null,r))},r)},r.prototype.getDirAttribs=function(e,t,n){this._initializeAndRunReadTransaction(function(r){r.executeSql("SELECT keyname, attribs FROM keyvalue where dir = ?",[e],function(e,n){for(var o={},r=0;r<n.rows.length;++r){var i=n.rows.item(r);o[i.keyname]=i.attribs}t(o)},o.bind(null,n))},n)},r.prototype.setItemsAsync=function(e,n,r){if(0===e.length)return t.error("WebSQL Error: setItemsAsync without names"),void r({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("WebSQL Error: setItemsAsync can only handle 1 item"),void r({code:9999,message:"setItemsAsync can only handle 1 item"});var i=e[0];this._initializeAndRunReadWriteTransaction(function(a){var s,l=i.key,c=l.lastIndexOf("/"),d="";-1!=c&&(d=l.substring(0,c)),s=l.substring(c+1),a.executeSql("INSERT OR REPLACE INTO 'keyvalue' ( 'keyname', 'dir', 'name', 'value', 'attribs' ) VALUES ( ? , ? , ?, ? , ? )",[i.key,d,s,i.value,i.attribs],function(o,a){a.rowsAffected!=e.length?(t.error("WebSQL Error: store error on key "+name),r({code:9999,message:"WebSQL store error: wrong # rows affected"})):null!=n?(t.debug("WebSQL: wrote ("+i.key+")"),n()):t.error("WebSQL Error: setItemsAsync no OK function")},o.bind(null,r))},r)},r.prototype.removeItemsAsync=function(e,n,r){if(0===e.length)return t.debug("WebSQL Error: removeItemsAsync without names"),void r({code:9999,message:"WebSQL Error: removeItemsAsync without names"});this._initializeAndRunReadWriteTransaction(function(i){for(var a="",s=0;s<e.length;++s)a+=(""==a?"":", ")+"?";i.executeSql("DELETE FROM keyvalue where keyname IN ("+a+")",e,function(o,r){t.debug("WebSQL: removed "+e.join(", ")),null!=n&&n()},o.bind(null,r))},r)},r.prototype.clearAllAsync=function(e,n){this._initializeAndRunReadWriteTransaction(function(r){r.executeSql("DELETE FROM keyvalue",[],function(n,o){t.debug("WebSQL: Cleared all"),null!=e&&e()},o.bind(null,n))},n)},r}()},286:function(e,t,n){var o=n(69).each,r=n(287);e.exports=function(e){var t=n(12).createLogger("IndexedDBAsyncKeyStore");var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;this.idbstore=t};return i.prototype.getItemsAsync=function(e,n,o){var r=this;if(t.debug("IndexedDBAsyncKeyStore getItemsAsync"),0===e.length)return t.debug("IndexedDB Error: getItemsAsync without names"),void o({code:9999,message:"IndexedDB Error: getItemsAsync without names"});var i={};e.reduce(function(e,n){return e.then(function(){return function(e){var n=this;return t.debug("readelem ",e),new Promise(function(o,r){n.idbstore.get(e).then(function(n){t.debug("read elem: "+e),null!=n&&(i[e]=n),o()},function(n){t.debug("error accessing elem: "+e),r(n)}).catch(function(e){t.error("Caught idb exception",e),r(e)})})}.bind(r,n)()})},Promise.resolve()).then(function(){n(i)},o)},i.prototype.getDirAttribs=function(e,n,r){t.debug("IndexedDBAsyncKeyStore getDirAttribs"),this.idbstore.direlems(e).then(function(e){var t={};o(e,function(e){t[e.keyname]=e.attribs}),n(t)},r)},i.prototype.setItemsAsync=function(e,n,o){if(t.debug("IndexedDBAsyncKeyStore setItemsAsync"),0===e.length)return t.error("IndexedDB Error: setItemsAsync without names"),void o({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("IndexedDB Error: setItemsAsync can only handle 1 item"),void o({code:9999,message:"setItemsAsync can only handle 1 item"});var r,i,a=e[0];this.idbstore.set(a.key,{keyname:a.key,value:a.value,attribs:a.attribs,dir:(r=a.key,i=r.lastIndexOf("/"),-1!=i?r.substring(0,i):"")}).then(function(){n()},o).catch(o)},i.prototype.removeItemsAsync=function(e,n,o){var r=this;if(t.debug("IndexedDBAsyncKeyStore removeItemsAsync"),0===e.length)return t.debug("IndexedDB Error: removeItemsAsync without names"),void o({code:9999,message:"IndexedDB Error: removeItemsAsync without names"});e.reduce(function(e,t){return e.then(function(){return r.idbstore.del(t)})},Promise.resolve()).then(function(){n()},o)},i.prototype.clearAllAsync=function(e,n){t.debug("IndexedDBAsyncKeyStore clearAllAsync"),this.idbstore.clear().then(e,n)},i}()},287:function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t),n.d(t,"Store",function(){return a}),n.d(t,"get",function(){return l}),n.d(t,"set",function(){return c}),n.d(t,"del",function(){return d}),n.d(t,"clear",function(){return u}),n.d(t,"direlems",function(){return f});var r,i=n(288),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bwds-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storeName=n,this._dbp=new i(function(e,o){var r=indexedDB.open(t,1);r.onerror=function(){return o(r.error)},r.onsuccess=function(){return e(r.result)},r.onupgradeneeded=function(){r.result.createObjectStore(n).createIndex("dir_idx","dir")}})}var t,n,r;return t=e,(n=[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then(function(o){return new i(function(r,i){var a=o.transaction(n.storeName,e);a.oncomplete=function(){return r()},a.onabort=a.onerror=function(){return i(a.error)},t(a.objectStore(n.storeName))})})}}])&&o(t.prototype,n),r&&o(t,r),e}();function s(){return r||(r=new a),r}function l(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.get(e)}).then(function(){return t.result})}function c(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:s())._withIDBStore("readwrite",function(n){n.put(t,e)})}function d(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readwrite",function(t){t.delete(e)})}function u(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s())._withIDBStore("readwrite",function(e){e.clear()})}function f(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.index("dir_idx").getAll(e)}).then(function(){return t.result})}},32:function(e,t){e.exports={BWDS_ERROR_INTERNAL:0,BWDS_ERROR_UNKNOWN:1,BWDS_ERROR_UNAVAILABLE:2,BWDS_ERROR_WRONG_ATTRIB:3,BWDS_ERROR_FULL:4,BWDS_ERROR_SECURITY:5}},323:function(e,t,n){var o,r,i;e.exports=(o=n(138),r=n(32),i=n(12).createLogger("AsyncKeyStoreToBWDSAdapter"),function(e){var t={};function n(e,n){t.queue.executeSequential(function(t){try{e(t)}catch(e){console.error("AsyncBWDS: Uncaught error: "+e),o.handleException(e,n,t)}})}return t.async=e,t.queue=o.newCallbackQueue(),t.readNoSync=function(e,n,o){i.debug("readNoSync "+e),t.async.getItemsAsync([e],function(o){if(o.hasOwnProperty(e)){var r=JSON.parse(o[e].attribs);!1===r.removed?n(o[e].value,t.fileStat(e,r)):n(null,t.fileStat(e,r))}else n(null,null)},function(e){o(e)})},t.read=function(e,i){n(function(n){t.readNoSync(e,function(e,t){null==e?o.callSafe(i,o.error(r.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"),null,t):o.callSafe(i,null,e,t),n()},function(e){o.handleException(e,i,n)})},i)},t.writeNoSync=function(e,n,r,a){i.debug("writeNoSync "+e+" "+n);var s=null==n?0:n.length;t.async.getItemsAsync([e],function(i){var l,c=o.getDateTime();i.hasOwnProperty(e)?((l=JSON.parse(i[e].attribs)).updated_at=c,l.filesize=s,l.isdir=null==n,l.removed=!1,l.version=l.version+1,l.offline=!1):l={created_at:c,updated_at:c,filesize:s,isdir:null==n,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1},t.async.setItemsAsync([{key:e,value:null==n?"":n,attribs:JSON.stringify(l)}],function(n){if(""!=e){var o=e.lastIndexOf("/"),i="";-1!=o&&(i=e.substring(0,o)),t.writeNoSync(i,null,r,a)}else r(t.fileStat(e,l))},function(e){a(e)})},function(e){a(e)})},t.write=function(e,r,i){n(function(n){t.writeNoSync(e,null==r?"":r,function(e){o.callSafe(i,null,e),n()},function(e){o.handleException(e,i,n)})},i)},t.removeFiles=function(e,n,r){if(0==e.length)null!=n&&n();else{var a=e.shift(),s=a.attribs,l=o.getDateTime();s.removed=!0,s.offline=!1,s.updated_at=l,t.async.setItemsAsync([{key:a.name,value:"",attribs:JSON.stringify(s)}],function(){t.removeFiles(e,function(){n(s)},r)},function(){i.error("removeFiles, could not write new file attribs to clear, removing including attribs"),t.async.removeItemsAsync([a.name],function(){t.removeFiles(e,function(){n(s)},r)},r)})}},t.removeRecurse=function(e,n,o){if(0==e.length)null!=n&&n();else{var r=e.shift();t.async.getDirAttribs(r,function(r){var i=[];for(var a in r){var s=JSON.parse(r[a]);!1===s.removed&&(!0===s.isdir&&e.push(a),i.push({name:a,attribs:s}))}t.removeFiles(i,function(){t.removeRecurse(e,n,o)},o)},o)}},t.removeNoSync=function(e,n,a){i.debug("removeNoSync "+e),""==e?t.removeRecurse([e],n,function(e){o.handleException(e,a)}):t.async.getItemsAsync([e],function(i){if(i.hasOwnProperty(e)){var s=JSON.parse(i[e].attribs);!1===s.removed?s.isdir?t.removeFiles([{name:e,attribs:s}],function(){t.removeRecurse([e],n,function(e){o.handleException(e,a)})},function(e){o.handleException(e,a)}):t.removeFiles([{name:e,attribs:s}],function(o){n(t.fileStat(e,o))},function(e){o.handleException(e,a)}):a(o.error(r.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))}else a(o.error(r.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))},function(e){o.handleException(e,a)})},t.remove=function(e,r){n(function(n){t.removeNoSync(e,function(){o.callSafe(r,null),n()},function(e){o.callSafe(r,e),n()})},r)},t.dirNoSync=function(e,n,r){i.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(t){var r=[];for(var i in t)!1===JSON.parse(t[i]).removed&&""!=i&&r.push(o.trimLeadingSlash(i.substr(e.length)));r.length>0?n(r):n(null)},function(e){r(e)})},t.dir=function(e,i){n(function(n){t.dirNoSync(e,function(t){null!==t?o.callSafe(i,null,t):""===e?o.callSafe(i,null,[]):o.callSafe(i,o.error(r.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){o.handleException(e,i,n)})},i)},t.fileStat=function(e,t){return{name:e,size:t.filesize,created:t.created_at,modified:t.updated_at,isdir:t.isdir,removed:t.removed,version:t.version,backup_version:t.backup_version,backup_date:t.hasOwnProperty("backup_date")?t.backup_date:null,offline:!!t.hasOwnProperty("offline")&&t.offline}},t.dirStat=function(e,n,o,r){i.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(e){var r=[];for(var i in e)""!==i&&r.push(t.fileStat(i,JSON.parse(e[i])));o(n,r)},function(e){r(e)})},t.statNoSync=function(e,n,o){i.debug("statNoSync "+e),t.async.getItemsAsync([e],function(r){if(r.hasOwnProperty(e)){var i=JSON.parse(r[e].attribs),a=t.fileStat(e,i);i.isdir?t.dirStat(e,a,n,o):n(a)}else n(null)},function(e){o(e)})},t.stat=function(e,i){n(function(n){t.statNoSync(e,function(e,t){null!==e?void 0===t?o.callSafe(i,null,e):o.callSafe(i,null,e,t):o.callSafe(i,o.error(r.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){o.handleException(e,i,n)})},i)},t.setStatNoSync=function(e,n,a,s){i.debug("setStatNoSync "+e),t.async.getItemsAsync([e],function(i){if(i.hasOwnProperty(e)){var l=JSON.parse(i[e].attribs);for(var c in n)if("backup_date"==c)l.backup_date=n.backup_date;else{if("backup_version"!=c)return void s(o.error(r.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+c));l.backup_version=n.backup_version}t.async.setItemsAsync([{key:e,value:i[e].value,attribs:JSON.stringify(l)}],function(n){a(t.fileStat(e,l))},function(e){o.handleException(e,s)})}else s(o.error(r.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},function(e){s(e)})},t.setStat=function(e,r,i){n(function(n){t.setStatNoSync(e,r,function(e){o.callSafe(i,null,e),n()},function(e){o.callSafe(i,e),n()})},i)},t.executeSync=function(e,n){t.queue.executeSequential(e,n)},t.removeAll=function(e){var n=[""],o=[],r=null;!function i(){if(o.length>0){var a=o.shift();t.removeNoSync(a,function(){i()},function(){console.log("Could not remove ",a),r="Could not remove file",i()})}else if(0!==n.length){var s=n.shift();t.dirStat(s,null,function(e,t){for(var r=0;r<t.length;++r){var a=t[r];a.removed||(a.isdir?n.push(a.name):o.push(a.name))}i()},function(){console.log("Error getting stat for ",s),r="Error removing files",i()})}else e(r)}()},t.clearAll=function(e){i.debug("clearAll"),t.async.clearAllAsync?t.async.clearAllAsync(function(){i.debug("AsyncBWDS.clearAll OK callback"),o.callSafe(e)},function(t){o.handleException(t,e)}):t.removeAll(e)},t})},324:function(e,t,n){e.exports=function(e,t,o){var r=n(12).createLogger("SyncKeyStoreToBWDSAdapter");function i(t,n){try{t()}catch(t){r.error("Uncaught error: "+t),e.handleException(t,n)}}return function(n){var o={};function a(n,r,i){return!1!==o.keystore.setItem(n,r)||(e.callSafe(i,e.error(t.BWDS_ERROR_FULL,"KeyStoreBWDS error: storage full"),null),!1)}return o.keystore=n,o.write=function(t,n,s){i(function(){r.debug("write "+t);var i,l,c=n.length,d=t.lastIndexOf(".");if(-1==d?(i=t,l=""):(i=t.substr(0,d),l=t.substr(d+1)),a(i,n,s))if(""!=i){var u,f=i.lastIndexOf("/"),g="";-1!=f&&(g=i.substring(0,f)),u=i.substring(f);var p,h=o.keystore.getItem(g),m=e.getDateTime();null===h?(p={})[u]={type:l,created_at:m,updated_at:m,filesize:c,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1}:(p=JSON.parse(h))[u]?(p[u].type=l,p[u].updated_at=m,p[u].filesize=c,p[u].version=p[u].hasOwnProperty("version")?p[u].version+1:2,p[u].removed=!1,p[u].offline=!1):p[u]={type:l,created_at:m,updated_at:m,filesize:c,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1};var v=o.fileStat(g,u,p[u]);o.write(g+".dir",JSON.stringify(p),function(t){e.callSafe(s,t,v)})}else e.callSafe(s,null,null)},s)},o.read=function(n,a){i(function(){var i,s;r.debug("read "+n);var l=n.lastIndexOf(".");-1==l?(i=n,s=""):(i=n.substr(0,l),s=n.substr(l+1));var c,d=i.lastIndexOf("/"),u="";-1!=d&&(u=i.substring(0,d)),c=i.substring(d);var f=o.keystore.getItem(u);if(null!==f){var g=JSON.parse(f);if(g[c])if(s&&g[c].type!=s)e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null);else if(!0===g[c].removed)e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: removed file"),null,o.fileStat(u,c,g[c]));else{var p=o.keystore.getItem(i);e.callSafe(a,null,p,o.fileStat(u,c,g[c]))}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: unknown file"),null,null)}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null)},a)},o.clearDir=function(e){var t=o.keystore.getItem(e);if(null!=t){var n=JSON.parse(t);for(var i in n)"dir"==n[i].type&&""!=i&&o.clearDir(e+i),r.debug("Clearing: "+e+i),o.keystore.removeItem(e+i);o.keystore.removeItem(e)}},o.clear=function(t,n){i(function(){if(r.debug("clear "+t),t)throw Error("clear(): Unexpected parameter");o.clearDir(""),e.callSafe(n,null)},n)},o.removeDir=function(t,n){r.debug("removeDir("+t+")");var i=o.keystore.getItem(t);if(null!=i){var s=JSON.parse(i),l=e.getDateTime();for(var c in s){var d=s[c];!1===d.removed&&("dir"===d.type?""!==c&&o.removeDir(t+c,n):(r.debug("Clearing: "+t+c),o.keystore.removeItem(t+c)),s[c].version=s[c].hasOwnProperty("version")?s[c].version+1:2,s[c].removed=!0,s[c].updated_at=l)}if(!a(t,JSON.stringify(s),n))return}},o.remove=function(n,a){i(function(){if(r.debug("remove "+n),""==n||null==n||null==n)return o.removeDir("",a),void e.callSafe(a,null);var i,s,l=n.lastIndexOf("."),c=(i=-1==l?n:n.substr(0,l)).lastIndexOf("/"),d="";-1!=c&&(d=i.substring(0,c)),s=i.substring(c);var u=o.keystore.getItem(d);if(null!==u){var f=JSON.parse(u);if(!f[s])return r.error("unknown file"),void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"));"dir"==f[s].type?o.removeDir(n,a):o.keystore.removeItem(i),f[s].removed=!0,f[s].version=f[s].hasOwnProperty("version")?f[s].version+1:2;var g=e.getDateTime();f[s].updated_at=g;var p=o.fileStat(d,s,f[s]);o.write(d+".dir",JSON.stringify(f),function(t){e.callSafe(a,t,p)})}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},a)},o.dir=function(n,a){i(function(){var i,s;if(r.debug("dir "+n),""!=n){var l,c=n.lastIndexOf("/"),d="";if(-1!=c&&(d=n.substring(0,c)),l=n.substring(c),null===(i=o.keystore.getItem(d)))return void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"));if(!1===(s=JSON.parse(i)).hasOwnProperty(l)||"dir"!==s[l].type)return void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"))}i=o.keystore.getItem(n),s=JSON.parse(i);var u=[];for(var f in s)!0!==s[f].removed&&u.push(e.trimLeadingSlash(f)+("dir"==s[f].type?"":"."+s[f].type));e.callSafe(a,null,u)},a)},o.fileStat=function(e,t,n){return{name:e+t+("dir"==n.type?"":"."+n.type),size:n.hasOwnProperty("filesize")?n.filesize:null==o.keystore.getItem(e+t)?0:o.keystore.getItem(e+t).length,created:n.created_at,modified:n.updated_at,isdir:"dir"==n.type,removed:n.hasOwnProperty("removed")&&!0===n.removed,version:n.version,backup_version:n.backup_version,backup_date:n.hasOwnProperty("backup_date")?n.backup_date:null,offline:!!n.hasOwnProperty("offline")&&n.offline}},o.dirStat=function(t,n,r){var i=o.keystore.getItem(t),a=JSON.parse(i),s=[];for(var l in a)s.push(o.fileStat(t,l,a[l]));e.callSafe(n,null,r,s)},o.stat=function(n,a){i(function(){if(r.debug("stat "+n),""!=n){var i,s,l=n.lastIndexOf("."),c=(i=-1==l?n:n.substr(0,l)).lastIndexOf("/"),d="";-1!=c&&(d=i.substring(0,c)),s=i.substring(c);var u=o.keystore.getItem(d);if(null!==u&&""!==u){var f=JSON.parse(u);if(f[s])return"dir"==f[s].type?void o.dirStat(n,a,o.fileStat(d,s,f[s])):void e.callSafe(a,null,o.fileStat(d,s,f[s]));e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else o.dirStat(n,a,{isdir:!0,name:""})},a)},o.setStat=function(n,s,l){i(function(){if(r.debug("stat "+n),""!=n){var i,c,d=n.lastIndexOf("."),u=(i=-1==d?n:n.substr(0,d)).lastIndexOf("/"),f="";-1!=u&&(f=i.substring(0,u)),c=i.substring(u);var g=o.keystore.getItem(f);if(null!==g){var p=JSON.parse(g);if(p[c]){if("dir"==p[c].type)return void e.callSafe(l,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"));for(var h in s)if("backup_date"==h)p[c].backup_date=s.backup_date;else{if("backup_version"!=h)return void e.callSafe(l,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+h));p[c].backup_version=s.backup_version}if(!a(f,JSON.stringify(p),l))return;e.callSafe(l,null,o.fileStat(f,c,p[c]))}else e.callSafe(l,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(l,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(l,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"))},l)},o.executeSync=function(e,t){e(function(){})},o.clearAll=function(e){i(function(){o.clear("",e)},e)},o}}(n(138),n(32))},325:function(e,t,n){var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(4),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(25).o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(326),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(13),a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(6),s=t.getConfigSync();return{createWidgetStorage:function(t,n,l,c,d,u,f,g){var p={},h=null,m=null,v=-1,w=null;return p.loadAll=function(r){var p,b,_,y={"widget-id":l,"widget-type":t,"widget-name":n,"teacher-id":d,"school-id":u,"course-id":f,"class-id":g};"undefined"!=typeof bwshortcode&&(y["widget-shortcode"]=bwshortcode),p=y,b=function(e){h=e.id,m=e.url,v=e.version,w=JSON.parse(e.data),e.isObserved&&i.showInfoMessage(a("Your progress on this activity will be shared with your teacher.")+' <i><a href="https://www.bookwidgets.com/kb/live-activity-widget" target="_blank">'+a("More info")+"</a></i>");try{r(c?w.hasOwnProperty("DATA")?w.DATA:"":w,v)}catch(e){console.error("Error in widget load callback"),console.error(e)}},_=function(e){403===e.status?(console.log("Online  storage nog allowed in this case, use offline storage: ",e.responseText),o.setForceOfflineStorage()):(console.error("Got error reading widget data"),o.goOffline()),r(c?null:{},-1)},e.ajax({type:"GET",dataType:"json",data:p,timeout:3e4,headers:{Authorization:"BWWAAuthToken "+o.getUserToken()},url:s.student_account_server+"/widget-storage/",connectTimeout:2e3,beforeSend:function(e,t){var n=this,o=t.xhr;t.xhr=function(){var e=o();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:b,error:_})},p.overwrite=function(t,n){var r=c?{DATA:t}:t;!function(t,n,r,i,a,s){var l={version:r,data:JSON.stringify(i),i:1},c=o.getUserToken();e.ajax({type:"PUT",contentType:"text/plain",data:JSON.stringify(l),url:n,headers:{Authorization:"BWWAAuthToken "+c},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,o=t.xhr;t.xhr=function(){var e=o();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:a,error:s})}(0,m,v,r,function(e){v=e.version,e.hasOwnProperty("url")&&(m=e.url),w=e.hasOwnProperty("data")?JSON.parse(e.data):r,n({status:"OK",data:c?w.hasOwnProperty("DATA")?w.DATA:null:w,version:v})},function(e,t,r){if(console.log("Got error putting widget data"),409==e.status){console.log("Conflict, someone wrote newer data");var i=JSON.parse(e.responseText);v=i.version,w=JSON.parse(i.data),n({status:"CONFLICT",data:c?w.hasOwnProperty("DATA")?w.DATA:null:w,version:v})}else o.goOffline(),n({status:"OFFLINE"})})},p.write=function(e,t){this.overwrite(c?e:function(e,t){var n=e||{};for(var o in t){var r=t[o];null===r?delete n[o]:n[o]=r}return n}(w,e),t)},p.writeImage=function(t,n){var i=e.Deferred();return function(t,n){var r=o.getUserToken(),i={name:n};return e.ajax({type:"POST",data:i,url:s.student_account_server+"/widget-storage/"+t+"/resources",headers:{Authorization:"BWWAAuthToken "+r},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,o=t.xhr;t.xhr=function(){var e=o();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}}})}(h,t).done(function(t){(function(t,n,o){var i=new FormData,a=new r([o],{type:"image/jpeg"});return i.append("file",a),e.ajax({url:t,data:i,processData:!1,contentType:!1,type:"POST"})})(t.upload_url,0,n).done(function(){i.resolve()}).fail(function(){console.log("upload resource failed"),i.reject()})}).fail(function(){console.log("getting image url failed"),i.reject()}),i},p.clearImage=function(t){return e.Deferred().resolve()},p.readImage=function(t){var n=s.student_account_server+"/widget-storage/"+h+"/resources/"+t,r=o.getUserToken(),i=e.Deferred();return e.ajax({url:n,headers:{Authorization:"BWWAAuthToken "+r},type:"GET"}).done(function(t){e.ajax({url:t.url,type:"GET"}).done(function(e){i.resolve(e)}).fail(function(){i.reject()})}).fail(function(){i.reject()}),i},p.sync=function(e){e()},p}}}.bind(null,n(0));e.exports={f:o,o:o()}},326:function(e,t){e.exports=window.Blob},327:function(e,t,n){var o,r,i;e.exports=(o=n(0),(i={}).init=function(){0===o("#storage-busy-marker").length&&o(document.createElement("div")).attr("id","storage-busy-marker").appendTo(".closebutton-container"),r=0},i.start=function(){0==r&&o("#storage-busy-marker").addClass("busy"),++r},i.end=function(){0==--r&&o("#storage-busy-marker").removeClass("busy")},i)},328:function(e,t,n){var o,r,i,a,s,l,c,d,u;e.exports=(o=n(4),r=n(25).o,i=n(73),a=n(0),s=n(6),l=n(46),c=n(2),d=n(13),u=o.getConfigSync(),{init:function(){function e(){return r.getState()===r.ANONYMOUS?r.requestSignin():r.requestSignout()}function t(){if(c.isPreview()){var t=r.hasSchool()?s("Students need school accounts associated with %(school)s (%(schoolCode)s) in order to sign in.").replace("%(school)s",u.student_account_school.name).replace("%(schoolCode)s",u.student_account_school.code)+"<br><br>":s("Any BookWidgets student account can be used to sign in.")+"<br><br>";d.showAlert(s("Your widget will require students to sign in.")+"<br><br>"+t+s("In widget preview mode sign in is not required / not supported."),s("Sign in not available"))}else i.pushAsyncFunc(e)}function n(e){var t="anonymous",n=s("Not signed in");switch(e){case r.OFFLINE:t="offline",n=s("You're offline");break;case r.ONLINE:t="online";var o=r.getUserName();-1!=o.indexOf("@")&&(o=o.substring(0,o.indexOf("@"))),n=o}var i=a("#loginbutton");if((i.safeHtml()!==n||i.attr("state")!==t)&&(i.safeHtml(n).attr({state:t}),e==r.OFFLINE||e==r.ONLINE)){var c=a(document.createElement("div")).addClass("login-change-wrapper").appendTo("#top-container"),d=i.clone();d.attr("id","login-change-alert").appendTo(c).fadeIn(400,"swing",function(){setTimeout(function(){d.fadeOut(400,"swing",function(){c.remove()})},1e3)}),i.effect&&i.effect("pulsate",{times:4},500)}l.centerTitle()}var o;o=a(document.createElement("div")).addClass("loginbutton bw-tooltext").attr("id","loginbutton"),l.prependToTitleToolbar(o),n(r.ANONYMOUS),o.tapOrClick(t),r.initialized().then(function(){n(r.getState()),r.registerStateChangeCallback(n)},function(){n(r.ANONYMOUS),a("#loginbutton").hide()})}})},329:function(e,t,n){e.exports=function(e,t,n,o,r,i,a,s){var l=e.getConfigSync(),c=a.getParameters();function d(e){return!e||0===e.length}function u(e){return e.indexOf("bookwidgets.com")>=0||e.indexOf("localhost")>=0?{"Bookwidgets-Platform":n.getPlatform()}:{}}function f(){return c.teacher_id}function g(){return c.hasOwnProperty("wv")}return{createStudentWorkSubmitter:function(e,p,h,m){var v={FLD_STUDENT_NAME:"#student",FLD_STUDENT_ACCOUNT:"#student_account",FLD_STUDENT_EMAIL:"#student_email",FLD_STUDENT_ID:"#student_id",FLD_STUDENT_CLASS_ID:"#student_class_id",FLD_TEACHER_EMAIL:"#email",FLD_YOUR_NAME:"#you",FLD_YOUR_EMAIL:"#your_email",FLD_TO_EMAIL:"#to_email"},w={};w[v.FLD_STUDENT_NAME]="student_name",w[v.FLD_STUDENT_EMAIL]="student_email",w[v.FLD_STUDENT_ID]="student_id",w[v.FLD_STUDENT_CLASS_ID]="student_class_id",w[v.FLD_TEACHER_EMAIL]="teacher_email",w[v.FLD_YOUR_NAME]="student_name",w[v.FLD_YOUR_EMAIL]="student_email",w[v.FLD_TO_EMAIL]="to_email";var b,_,y,S,k=f();v._postdata={test_name:e,uuid2:h,WA:m,book_title:p,submit_timestamp:(new Date).toISOString(),submit_date:(b=new Date,_=b.getDate(),y=b.getMonth()+1,S=b.getYear(),S<1900&&(S+=1900),(1==y?"January":2==y?"February":3==y?"March":4==y?"April":5==y?"May":6==y?"June":7==y?"July":8==y?"August":9==y?"September":10==y?"October":11==y?"November":"December")+" "+_+", "+S),tzoffset:(new Date).getTimezoneOffset()/60*-1,include_grading:!0,submitted_via_shortcode:window.bwshortcode,answers:[]},"wv"in c&&(v._postdata.wv=c.wv),v._extradata={},v._answersComposer=void 0,v._assetUploadAgenda=[],v._eventCallbacks={},v._lastServerResponse="",v._lastServerData=null,v._leftButtons=[],v._rightButtons=[],v._dialogOptions={},v._endpoint="",v._fieldSettings={},v.setCompanyInfo=function(e,t,n,o){v._postdata.company_name=e,v._postdata.company_address=t,v._postdata.company_phone=n,v._postdata.company_website=o},v.setIncludeGrading=function(e){v._postdata.include_grading=e?"yes":"no"},v.setElapsedTime=function(e){v._postdata.time=e},v.setEndpoint=function(e){v._endpoint=e},v._storeField=function(e,n){var o=v._fieldSettings[e].isVisible,r=v._fieldSettings[e].isEditable;if(o&&r){var i=w[e];t.set(i,n)}},v._setStudentInfo=function(e,n,o,r){v._postdata.student_name=e,v._postdata.student_id=n,v._postdata.student_email=o,v._postdata.student_class_id=r,t.hasStudentAccount()&&(v._postdata.student_userid=t.getStudentAccountUserId(),v._postdata.student_name=t.getStudentAccountUserName(),v._postdata.student_email=t.getStudentAccountEmail(),v._postdata.student_id=t.getStudentAccountProviderHumanId(),v._postdata.student_token=t.getStudentAccountToken());var i=c.context_id;i&&(v._postdata.context_id=i),k&&(v._postdata.teacher_id=k),c.course_id&&(v._postdata.course_id=c.course_id),v._storeField(v.FLD_STUDENT_NAME,e),v._storeField(v.FLD_STUDENT_ID,n),v._storeField(v.FLD_STUDENT_EMAIL,o),v._storeField(v.FLD_STUDENT_CLASS_ID,r)},v._setTeacherEmail=function(e){v._postdata.teacher_email=e,v._storeField(v.FLD_TEACHER_EMAIL,e)},v._setShareInfo=function(e,t,n,o){v._postdata.student_name=e,v._postdata.student_email=t,v._postdata.to_email=n,v._postdata.message=o,v._storeField(v.FLD_YOUR_NAME,e),v._storeField(v.FLD_YOUR_EMAIL,t),v._storeField(v.FLD_TO_EMAIL,n)},v._setDownloadInfo=function(e,t,n,o){v._postdata.student_name=e,v._storeField(v.FLD_YOUR_NAME,e)},v.setAnswersComposer=function(e){v._answersComposer=e},v.addExtraData=function(e){for(var t in e)v._extradata[t]=e[t]},v.scheduleAssetUpload=function(e,t,n){v._assetUploadAgenda.push({assetFetcherCB:e,assetUploadCompleteCB:t,userdata:n})},v.configureFormField=function(e,t,n,o){v._fieldSettings[e]={isVisible:t,isEditable:n,defaultValue:o}},v.configureFormField(v.FLD_STUDENT_ACCOUNT,!0===t.hasStudentAccount(),!1,t.getStudentAccountUserName()||""),v.configureFormField(v.FLD_STUDENT_NAME,!1===t.hasStudentAccount()&&"yes"==l.student_name_isVisible,"yes"==l.student_name_isEditable,l.student_name_defaultValue),v.configureFormField(v.FLD_STUDENT_EMAIL,!1===t.hasStudentAccount()&&"yes"==l.student_email_isVisible,"yes"==l.student_email_isEditable,l.student_email_defaultValue),v.configureFormField(v.FLD_STUDENT_ID,!1===t.hasStudentAccount()&&"yes"==l.student_id_isVisible,"yes"==l.student_id_isEditable,l.student_id_defaultValue);var C=d(c.student_class_id)?d(t.getStudentAccountClassName())?void 0:t.getStudentAccountClassName():c.student_class_id,E="yes"==l.student_class_id_isEditable&&!C;function I(e,t,n,r){var i,a=o(document.createElement("label"));a.attr("for",t),a.attr("id",t+"_label"),a.text(e),r.append(a),"textarea"==n?(i=o(document.createElement("textarea"))).attr("rows",5):((i=o(document.createElement("input"))).attr("type",n),i.attr("onfocus","this.value = this.value;")),i.attr("name",t),i.attr("id",t),i.attr("value",""),r.append(i)}function O(e){return e.split(",").length>1}function x(e,t){var o={content:"",ibw_platform:n.getPlatform()};for(var r in v._extradata)o[r]=v._extradata[r];void 0===v._submitPreparer&&(v._submitPreparer=function(e){e()}),v.showProgressDialog(t),setTimeout(function(){v._submitPreparer(function(){v.uploadAssets(function(){console.log("All assets uploaded, now sending answers"),v.composeAllAnswers(),o.content=JSON.stringify(v._postdata),e(o),v.trigger(v.EVT_AFTER_SEND),console.log("Submit complete")},function(){console.log("Asset upload failed, aborting"),v.closeProgressDialog(),v.trigger(v.EVT_SUBMIT_FAILED),v.trigger(v.EVT_AFTER_SEND)})},function(e){console.log("Aborted by client: "+e),v.closeProgressDialog(),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED),v.trigger(v.EVT_AFTER_SEND)})},100)}function T(){x(v.sendResults.bind(v),i("Sending, please wait..."))}function A(){var e=o(this),n=e.find("#student").val(),a=e.find("#student_id").val(),s=e.find("#student_email").val(),c=e.find("#student_class_id").val(),d=e.find("#email").val();if(!1!==t.hasStudentAccount()||""!==n){if(!k){if(!(null!=d&&""!==d||"yes"===l.teacher_email_isVisible&&"yes"===l.teacher_email_isEditable||!1!==g()))return void r.showAlert(i("This field is required:")+" "+i("Teacher Email"),i("Send Failed"));if(O(d))return void r.showAlert(i("You can't specify multiple addresses for field:")+" "+i("Teacher Email"),i("Send Failed"))}e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setStudentInfo(n,a,s,c),v._setTeacherEmail(d),T()}else r.showAlert(i("This field is required:")+" "+i("Student Name"),i("Send Failed"))}function D(){var e=o(this),t=e.find("#you").val(),n=e.find("#your_email").val(),a=e.find("#to_email").val(),s=e.find("#message").val();""!==t?""!==a?(e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setShareInfo(t,n,a,s),T()):r.showAlert(i("This field is required:")+" "+i("To Email"),i("Send Failed")):r.showAlert(i("This field is required:")+" "+i("Your Name"),i("Send Failed"))}function N(){var e=o(this),t=e.find("#you").val();""!==t?(e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setDownloadInfo(t),x(v.generate.bind(v),i("Generating PDF, please wait..."))):r.showAlert(i("This field is required:")+" "+i("Your Name"),i("Download Failed"))}return v.configureFormField(v.FLD_STUDENT_CLASS_ID,"yes"==l.student_class_id_isVisible,E,d(C)?d(l.student_class_id_defaultValue)?"":l.student_class_id_defaultValue:C),v.configureFormField(v.FLD_TEACHER_EMAIL,"yes"==l.teacher_email_isVisible&&!k,"yes"==l.teacher_email_isEditable,c.teacher_email||l.teacher_email_defaultValue),v.configureFormField(v.FLD_YOUR_NAME,!0,!0,""),v.configureFormField(v.FLD_YOUR_EMAIL,!0,!0,""),v.configureFormField(v.FLD_TO_EMAIL,!0,!0,""),v.addButtonBeforeDefaultButtons=function(e,t){v._leftButtons.push({text:e,click:t})},v.addButtonAfterDefaultButtons=function(e,t){v._rightButtons.push({text:e,click:t})},v.addDialogOptions=function(e){for(var t in e)v._dialogOptions[t]=e[t]},v.setAsyncSubmitPreparer=function(e){v._submitPreparer=e},v.EVT_BEFORE_SHOW="beforeShow",v.EVT_BEFORE_SEND="beforeSend",v.EVT_AFTER_SEND="afterSend",v.EVT_SUBMIT_SUCCEEDED="submitSucceeded",v.EVT_SUBMIT_FAILED="submitFailed",v.on=function(e,t){v._eventCallbacks[e]?v._eventCallbacks[e].push(t):(v._eventCallbacks[e]=[],v._eventCallbacks[e].push(t))},v.trigger=function(e){if(v._eventCallbacks[e])for(var t=0;t<v._eventCallbacks[e].length;++t)v._eventCallbacks[e][t]()},v._applyFormFieldSettings=function(e){if(0!=(s=o(e)).length){var n=o(e+"_label"),r=v._fieldSettings[e].isVisible,i=v._fieldSettings[e].isEditable,a=v._fieldSettings[e].defaultValue;O(a)&&(r&&i?function(e,t){for(var n=o(e),r=o(document.createElement("select")).attr({id:n.attr("id"),name:n.attr("name")}),i=0;i<t.length;++i)o(document.createElement("option")).safeHtml(t[i]).appendTo(r);n.replaceWith(r),n.remove()}(e,function(e){for(var t=e.split(","),n=[],o=0;o<t.length;++o)n.push(t[o].trim());return n}(a)):a=a.split(",")[0]);var s=o(e);if(n=o(e+"_label"),!1===r&&(s.hide(),n.hide()),!1===i&&s.attr("disabled","true"),s.val(a),r&&i){var l=w[e];t.get(l,function(e){null!=e&&""!==e&&s.val(e)})}}},v.showSendDialog=function(e,n){t.initialized().done(function(){if(t.isCoAccount())r.showAlert(i("Submit is disabled because you're not logged in with a student account. e.g. a parent account."),i("Can't submit"));else{var l=function(){o("#student-work-submitter-dialog").remove();var e=o(document.createElement("div"));e.attr("id","student-work-submitter-dialog"),e.css("display","none");var t=o(document.createElement("div"));return t.attr("id","student-work-submitter-dialog-info"),e.append(t),I("","student_account","text",e),I(i("Student Name"),"student","text",e),I(i("Student ID"),"student_id","text",e),I(i("Student Email"),"student_email","email",e),I(i("Class ID"),"student_class_id","text",e),I(i("Teacher Email"),"email","email",e),o("body").append(e),e}(),c=!1;for(var d in v._fieldSettings)v._applyFormFieldSettings(d),c=c||v._fieldSettings[d].isVisible&&v._fieldSettings[d].isEditable&&o(d).length>0;e?(o("#student-work-submitter-dialog-info").safeHtml(e),o("#student-work-submitter-dialog-info").removeClass("hidden")):o("#student-work-submitter-dialog-info").addClass("hidden");for(var u=[],f=0;f<v._leftButtons.length;++f)u.push(v._leftButtons[f]);for(u.push({text:i("Send"),click:A}),f=0;f<v._rightButtons.length;++f)u.push(v._rightButtons[f]);var g={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:i("Send Answer"),width:Math.min(450,.9*o(window).width())+"px",buttons:u};for(var p in v._dialogOptions)g[p]=v._dialogOptions[p];l.dialog(g);var h=a.getQueryParams(window.location.search).toplevel;c||1!==u.length||!n||!s.isLTI()||h||A.call(l)}})},v.showShareDialog=function(e){console.log("showShare"),t.initialized().done(function(){var t=function(){o("#student-work-share-dialog").remove();var e=o(document.createElement("div"));e.attr("id","student-work-share-dialog"),e.css("display","none");var t=o(document.createElement("div"));return t.attr("id","student-work-share-dialog-info"),e.append(t),I(i("Your Name"),"you","text",e),I(i("Your Email"),"your_email","email",e),I(i("To Email"),"to_email","email",e),I(i("Optional Message"),"message","textarea",e),o("body").append(e),e}();for(var n in v._fieldSettings)v._applyFormFieldSettings(n);e?(o("#student-work-share-dialog-info").safeHtml(e),o("#student-work-share-dialog-info").removeClass("hidden")):o("#student-work-share-dialog-info").addClass("hidden");for(var r=[],a=0;a<v._leftButtons.length;++a)r.push(v._leftButtons[a]);for(r.push({text:i("Send"),click:D}),a=0;a<v._rightButtons.length;++a)r.push(v._rightButtons[a]);var s={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:i("Share"),width:Math.min(450,.9*o(window).width())+"px",buttons:r};for(var l in v._dialogOptions)s[l]=v._dialogOptions[l];t.dialog(s)})},v.showDownloadDialog=function(e){console.log("showDownload"),t.initialized().done(function(){var t=function(){o("#student-work-download-dialog").remove();var e=o(document.createElement("div"));e.attr("id","student-work-download-dialog"),e.css("display","none");var t=o(document.createElement("div"));return t.attr("id","student-work-download-dialog-info"),e.append(t),I(i("Your Name"),"you","text",e),o("body").append(e),e}();for(var n in v._fieldSettings)v._applyFormFieldSettings(n);e?(o("#student-work-download-dialog-info").safeHtml(e+"<br>"),o("#student-work-download-dialog-info").removeClass("hidden")):o("#student-work-download-dialog-info").addClass("hidden");for(var r=[],a=0;a<v._leftButtons.length;++a)r.push(v._leftButtons[a]);for(r.push({text:i("Generate"),click:N}),a=0;a<v._rightButtons.length;++a)r.push(v._rightButtons[a]);var s={dialogClass:"bw-student-work-submitter",modal:!0,title:i("Download as PDF"),width:Math.min(450,.9*o(window).width())+"px",buttons:r};for(var l in v._dialogOptions)s[l]=v._dialogOptions[l];t.dialog(s)})},v.showProgressDialog=function(e){(function(){var e="student-work-submitter-progress-dialog";o("#"+e).remove();var t=o(document.createElement("div"));t.attr("id",e),t.css("display","none");var n=o(document.createElement("div"));n.addClass("spinner"),t.append(n);var r=o(document.createElement("div"));return r.addClass("progress-message"),r.text(i("Uploading your answers...")),t.append(r),o("body").append(t),t})().dialog({modal:!0,dialogClass:"no-close bw-dialog",title:e})},v.updateProgressMessage=function(e){o(".progress-message").text(e)},v.closeProgressDialog=function(){o("#student-work-submitter-progress-dialog").remove()},v.uploadAssets=function(e,t){var n=v._assetUploadAgenda,o=null,r=0,a=n.length;(o=function(){if(n.length>0){var s=n.shift(),l=s.assetFetcherCB(s.userdata);++r,l?(v.updateProgressMessage(("audio/mpeg"===l.mimetype?i("Uploading audio"):i("Uploading image"))+" "+r+" / "+a),v.sendAsset(l,function(e){s.assetUploadCompleteCB(e,s.userdata),o()},function(){v._lastServerResponse=void 0,t()})):o()}else v.updateProgressMessage(i("Uploading your answers...")),e()})()},v.sendAssetAjax=function(e,t,n){var r={content:JSON.stringify({is_asset:!0,asset_data:e.data,asset_mimetype:e.mimetype})};for(var i in v._extradata)r[i]=v._extradata[i];o.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:r,success:function(e){t(e)},error:function(){n()}})},v.genRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},v.sendAsset=v.sendAssetAjax,v.composeAllAnswers=function(){v._postdata.answers=v._answersComposer()},v.sendAudioPacket=function(e,t,n,r,i){var a=v._endpoint+".m4a?t="+e+"&d="+t+"&p="+n,s=new Audio;o(s).on("loadedmetadata",function(){var e=Math.floor(10*o(this)[0].duration);r(e)}),o(s).on("error",function(){console.log("Audio package load failure: "+s.error.code),i("Network or server problem")}),s.src=a},v.getPacket=function(e){for(var t=0,n=e.length,o=0,r="",i="";;){var a=n-t;if(0===a)break;var s=e.substr(t,100),l=encodeURIComponent(s),c=l.length;if(o+c>1900){i=e.substr(t);break}t+=a<100?a:100,r+=l,o+=c}return{packet:r,remaining:i}},v.sendAudio=function(e,t,n,o,r){void 0===o&&(o=v.genRandomString(20)),void 0===r&&(r=1);var i,a=v.getPacket(e);""===a.remaining?(i=t,r=0):i=function(e,t,n){return function(i){0===i?v.sendAudio(e,t,n,o,r+1):n("Wrong server response")}}(a.remaining,t,n),v.sendAudioPacket(o,a.packet,r,i,n)},v.sendResultsAudio=function(e){v.sendAudio(JSON.stringify(e),function(e){switch(console.log("sendAudio success handler called"),v.closeProgressDialog(),e){case 0:console.error("Oops, server expected another packet..."),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED);break;case 1:console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED);break;case 2:console.error("Network or server error"),v._lastServerResponse="NEWUSER",v.trigger(v.EVT_SUBMIT_FAILED);break;case 3:console.error("Network or server error"),v._lastServerResponse="USERNOTACTIVE",v.trigger(v.EVT_SUBMIT_FAILED);break;case 4:console.error("Network or server error"),v._lastServerResponse="INVALIDUSER",v.trigger(v.EVT_SUBMIT_FAILED);break;case 5:console.error("Network or server error"),v._lastServerResponse="STUDENTNOTAUTHORIZED",v.trigger(v.EVT_SUBMIT_FAILED);break;default:console.error("Unexpected server return value"),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED)}},function(e){console.error("sendAudio error handler called: "+e),v.closeProgressDialog(),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED)})},v.sendResultsAjax=function(e){e.accept_json_response=!0,l.hasOwnProperty("widget_language")&&""!=l.widget_language&&(e.lang=l.widget_language),o.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:e,success:function(e,t,n){console.log("Submit OK"),v.closeProgressDialog();var o=n.getResponseHeader("Content-Type");switch(v._lastServerResponse=e,v._lastServerMessage=null,v._lastServerData=null,o){case"application/json":e.hasOwnProperty("status")&&"OK"===e.status?(console.log("That's a success!"),v._lastServerData=e.data,v.trigger(v.EVT_SUBMIT_SUCCEEDED)):e.hasOwnProperty("code")?(console.log("That's a failure!",e),v._lastServerResponse=e.code,v._lastServerMessage=e.message,v.trigger(v.EVT_SUBMIT_FAILED)):(console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED));break;case"text/html":console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED);break;default:"OK"==e?(console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED)):(console.log("That's a failure!"),v.trigger(v.EVT_SUBMIT_FAILED))}},error:function(e){console.error("AJAX error handler called");try{var t=JSON.parse(e.responseText);v._lastServerResponse=null,v._lastServerData=null,v._lastServerMessage=t.message}catch(e){console.error("Error msg not json"),v._lastServerResponse=void 0}v.closeProgressDialog(),v.trigger(v.EVT_SUBMIT_FAILED)}})},v.generate=function(e){o.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:e,success:function(e,t,n){var a,s,l;console.log("AJAX success handler called"),v.closeProgressDialog(),"application/json"==n.getResponseHeader("Content-Type")?(console.log("That's a success!"),v._lastServerResponse=e,a=e.url,s=e.filename,l=o(document.createElement("div")).append(o(document.createElement("a")).attr({href:a,download:s}).safeHtml(i("Click here to download your PDF"))),r.showAlert(l.html(),i("PDF generated"))):(console.log("That's a failure!"),v._lastServerResponse=e,r.showAlert(i("Could not generate PDF.  Please try again later."),i("Generate PDF failed")))},error:function(){console.log("AJAX error handler called"),v.closeProgressDialog(),v._lastServerResponse=void 0,r.showAlert(i("Could not generate PDF.  Please try again later."),i("Generate PDF failed"))}})},v.sendResults="ibw-platform-ipad-ibooks-epub"==n.getPlatform()?v.sendResultsAudio:v.sendResultsAjax,v.getLastServerResponse=function(){return v._lastServerResponse},v.getLastServerMessage=function(){return v._lastServerMessage},v.getLastServerData=function(){return v._lastServerData},v.afterSubmitFailed=function(e,t){var n="",o=this.getLastServerResponse();if(o)if(n=e+"<br><br>","NEWUSER"===o)n+=i("The email address you provided has not been registered.")+"<br><br>",n+=i("To prevent abuse, results can only be sent to registered email addresses.")+" ",n+=i("Activate by clicking on the link in the email which was sent to the address provided.")+" ",n+=i("You can also register at www.bookwidgets.com.")+"<br>";else if("USERNOTACTIVE"===o)n+=i("The email address you provided has not been activated.")+"<br><br>",n+=i("To prevent abuse, results can only be sent to registered email addresses.")+" ",n+=i("Activate by clicking on the link in the email which was sent to the address provided.")+" ",n+=i("You can also register at www.bookwidgets.com.")+"<br>";else if("INVALIDUSER"===o)n+=i("Invalid user name")+"<br>";else{var a;n+=(a=this.getLastServerMessage())?a+"<br>":i("Unknown error")+"<br>"}else(a=this.getLastServerMessage())?n+=a+"<br>":n=t;r.showAlert(n,i("Send Failed"))},v},isTeacherEmailRequired:function(){return!f()&&!g()}}}(n(4),n(330).o,n(2),n(0),n(13),n(6),n(5),n(71))},330:function(e,t,n){var o=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(4),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(25).o,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(74).o,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(139).o,s={},l=e.Deferred();s.initialized=function(){return l};var c=t.getParameters(),d=c.hasOwnProperty("teacher_id")?c.teacher_id:"",u=c.hasOwnProperty("school_id")?c.school_id:"";return o.getConfig().then(function(t){var n="no"!==t.save_answers;function o(e){return"student_name"==e||"student_email"==e||"student_id"==e}var c=null,f=-1;function g(o){if(l.resolve(),o==f)return console.log("Warning: setting identical storage state, ignoring"),e.when();var s=t.book_title&&""!==t.book_title?t.book_title:"_no_name_";switch(o){case r.ANONYMOUS:c=i.createInfoStorage(s,"",n);break;case r.OFFLINE:c=i.createInfoStorage(s,r.getUserId(),n);break;case r.ONLINE:c=a.createInfoStorage(s,d,u)}return f=o,e.when()}s.get=function(e,t){if(f!=r.ANONYMOUS&&r.hasProperty(e))t(r.getProperty(e));else if(n){var i=function(n){t(n[e])};o(e)?c.getCommonProperties(i):c.getGroupProperties(i)}else t(null)},s.set=function(e,t){if(f!=r.ANONYMOUS&&r.hasProperty(e))console.log("Request setting read-only property... skipping");else if(n){var i={};i[e]=t,o(e)?c.setCommonProperties(i):c.setGroupProperties(i)}},s.hasStudentAccount=function(){return f==r.OFFLINE||f==r.ONLINE},s.getStudentAccountUserId=function(){return r.getUserId()},s.getStudentAccountUserName=function(){return r.getUserName()},s.getStudentAccountEmail=function(){return r.getEmail()},s.getStudentAccountProviderId=function(){return r.getProviderId()},s.getStudentAccountProviderHumanId=function(){return r.getProviderHumanId()},s.getStudentAccountToken=function(){return r.getUserToken()},s.getStudentAccountClassName=function(){return r.getUserClassName()},s.isCoAccount=function(){return r.isCoAccount()},r.initialized().then(function(){g(r.getState()),r.registerStateChangeCallback(g)},function(){g(r.ANONYMOUS)})}),s}.bind(null,n(0),n(5));e.exports={f:o,o:o()}},331:function(e,t,n){var o,r;e.exports=(o=n(6),r=n(0),function(e,t,n){var i=e.config,a=e.hasOwnProperty("submitName")?e.submitName:""==i.id?""==i.title?e.defaultName:i.title:i.id;function s(n){var o=t.createStudentWorkSubmitter(a,i.book_title,i.uuid2,i.WA);o.setCompanyInfo(i.company_name,i.company_address,i.company_phone,i.company_website);var r=[],s=[];function l(e){return{data:e(),mimetype:"image/png"}}e.assetFetcherCB&&e.assetUploadCompleteCB?(r=[e.assetFetcherCB],s=[e.assetUploadCompleteCB]):e.assetFetcherLister&&e.assetUploadCompleteLister&&(r=e.assetFetcherLister(),s=e.assetUploadCompleteLister());for(var c=0;c<r.length;++c)o.scheduleAssetUpload(l.bind(null,r[c]),s[c]);return o.setAnswersComposer(function(){return e.getAnswers(n)}),o}function l(t){var r=s(t);return r.on(r.EVT_SUBMIT_SUCCEEDED,function(){n.showAlert(e.submitSuccessMessage,o("Sent successfully"))}),r.on(r.EVT_SUBMIT_FAILED,r.afterSubmitFailed.bind(r,e.submitFailedTitle,e.submitFailedMessage)),r}"yes"!=i.submit_answers&&"yes"!=i.send_drawing||r("#sendbutton").show().click(function(){var t=l(!0);t.setEndpoint(i.action),t.setIncludeGrading("yes"==i.email_should_have_grading),t.showSendDialog(e.sendDialogMessage)}),"yes"==i.allow_sharing&&r("#sharebutton").show().click(function(){var t=l(!1);t.setEndpoint(i.share_action),t.setIncludeGrading(!1),t.showShareDialog(e.shareDialogMessage)}),"yes"==i.allow_download&&r("#downloadbutton").show().click(function(){var e=s(!1);e.setEndpoint(i.download_action),e.setIncludeGrading(!1),e.showDownloadDialog(o("Enter your name and click 'Generate' to generate the PDF."))})})},332:function(e,t,n){var o;e.exports=(o=n(0),function(e,t){var n=o(document.createElement("div")).css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden","font-size":t,"font-family":e}).appendTo(o("body"));return{measure:function(e){return n.text(e),n.width()+1},destroy:function(){n.remove()}}})},333:function(e,t,n){var o=n(69).extend,r=n(121);e.exports=function(e,t,i){var a=n(12).createLogger("ProgressLogger"),s=new e;s.startListening();return function(e){var n=void 0!==e||"ibw-platform-ipad-bookwidgets"===t.getPlatform();e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var i={};function l(e,t){i.callObjC("progress",o({cmd:e},t),function(){a.error("ProgressLogger: OK for:"+e)},function(){a.error("ProgressLogger: ERROR for:",e)})}i.resultForCallback=function(e,t){s.processCallback(e,t)},i.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},i.callObjC=function(t,n,o,a){var l=r.url(t,n),c=s.registerCallbacks(o,a),d="'"+c.ok+"'",u="'"+c.error+"'",f="ProgressLogger.resultForCallback";i.runningInIframe()&&(f="function ProgressLogger_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; ProgressLogger_callback_wrapper"),e(l+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+f)},i.restart=function(){n&&l("restart")},i.registerScore=function(e,t,o,r,i){return n?(l("registerScore",{identifier:e,title:t,score:r,maxScore:o,primary:!0===i}),{lastval:r,update:function(n){return n!==this.lastval&&(l("updateScore",{identifier:e,title:t,score:n,maxScore:o,primary:!0===i}),this.lastval=n,!0)}}):{update:function(){return!1}}},i.registerBinary=function(e,t,n,o,r){return{update:function(){return!1}}},i.registerQuantity=function(e,t,o,r){return n?(l("registerQuantity",{identifier:e,title:t,quantity:o,primary:!0===r}),{lastval:o,update:function(n){return n!==this.lastval&&(l("updateQuantity",{identifier:e,title:t,quantity:n,primary:!0===r}),this.lastval=n,!0)}}):{update:function(){return!1}}};var c=0;return i.setProgress=function(e,t){if(n){var o=Math.max(0,Math.min(1,e/t));o!==c&&(l("setProgress",{progress:o}),c=o)}},i.registerSet=function(e,t,o,r){if(!n)return{registerAccess:function(){return!1}};var i=this;return{elements:[],accesscount:0,accessedcount:0,accessedLogger:this.registerQuantity(e+"accessed",t,0),accessesLogger:this.registerQuantity(e+"accesses",o,0),registerAccess:function(e){return this.accessesLogger.update(++this.accesscount),this.elements.hasOwnProperty(e)||(this.elements[e]=!0,this.accessedLogger.update(++this.accessedcount),i.setProgress(this.accessedcount,r)),!0}}},window.ProgressLogger=i,i}}(n(70),n(2))},4:function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=n(178).default;e.exports=function(e,t){var n={},i=t.Deferred();function a(e){return function e(n,r){if("string"==typeof n)return n.replace(/\$RESOURCEDIR/g,r);if(t.isArray(n)){for(var i=[],a=0;a<n.length;++a)i.push(e(n[a],r));return i}if("object"===o(n)){var s={};for(var l in n)n.hasOwnProperty(l)&&(s[l]=e(n[l],r));return s}return n}(e,(n="",0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?n=window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets":"widgets-eu.bookwidgets.com"===window.location.host&&(n="//widget-assets-eu.bookwidgets.com"),n));var n}return r().then(function(r){var s=function(e){var n=function e(n){if("string"==typeof n)return function(e){for(var t="",n=0;n<e.length;++n)2*n<e.length?t+=e.charAt(2*n):t+=e.charAt(2*(e.length-n)-1);return t}(n);if(t.isArray(n)){for(var r=[],i=0;i<n.length;++i)r.push(e(n[i]));return r}if("object"===o(n)){var a={};for(var s in n)n.hasOwnProperty(s)&&(a[s]=e(n[s]));return a}return n}(e);return n=a(n)}(r);for(var l in s)n[l]=s[l];e(n),i.resolve(n)}),{fixResourcePaths:a,getConfig:function(){return i},getConfigSync:function(){return n}}}(n(184),n(0))},46:function(module,exports,__webpack_require__){var _require=__webpack_require__(102),valueOrCacheValue=_require.valueOrCacheValue;module.exports=function(platform,qs,cssUpdater,printer,dialog,tr,$,uiComponents,uriEncodeImage,bwTool,adaptToPageProtocol,bwTouchHelpers){function getNakedURL(e){if(-1===e.indexOf("?"))return e;var t=/^([^\?]*)\?/.exec(e);if(t&&2===t.length)return t[1];throw Error("Shoudln't happen")}function setQueryParameters(e,t){if(t==={})return e;var n=getNakedURL(e),o=[];return $.each(t,function(e,t){o.push(e+"="+t)}),n+"?"+o.join("&")}function ShowBacklinkIfRequired(){var e=qs.getUrlParams(window.location.href);if(e.hasOwnProperty("backlink")){var t=valueOrCacheValue(e.backlink);(e.hasOwnProperty("backbutton")?$(document.createElement("div")).addClass("widget-backlink widget-backlink-text").safeHtml("&#9664; ").text(valueOrCacheValue(e.backbutton)).appendTo($("body")):$(document.createElement("div")).addClass("widget-backlink widget-backlink-icon").appendTo($("body"))).click(function(){var e=platform.getPlatform();if("ibw-platform-osx-preview"===e||"ibw-platform-win32-preview"===e)console.log("Moving back by using history.back()"),window.history.back();else{var n=window.location.origin;t.startsWith(n)&&(t=t.substr(n.length)),console.log("Moving back by setting window.location to: "+t),window.location=t}})}}var block_recurse_guard=!1;function centerWidgetTitle(e){if(!block_recurse_guard){var t=$("#top-container"),n=t.height(),o=t.width(),r=$(".closebutton-container"),i=$("#top-container .bw-toolbar");r.css("min-width",""),i.css("min-width","");var a=r.width(),s=i.width();if(i.css("min-width",a),r.css("min-width",s),$(".title-container").css("max-width",o-2*Math.max(a,s)),!0!==e&&$("#top-container").height()!==n){block_recurse_guard=!0;try{window.onresize&&window.onresize()}catch(e){console.error("Error when calling onResize during centerWidgetTitle"),console.error(e)}block_recurse_guard=!1}}}function hidePopupMenu(){$("#top-container").removeClass("bw-show-popup-menu"),$("#title-toolbar").appendTo($("#top-container .bw-toolbar")),$(".bw-menu-overlay").remove()}function createPopupToolbarIfRequired(){if(!($("#menubutton").length>0)){var e=$("#top-container .bw-toolbar");if(e.children(":not(.outside-popup)").length>1){e.removeClass("bw-toolbar");var t=$(document.createElement("div")).addClass("bw-toolbar").appendTo($(".titlebar-layout"));e.find(".outside-popup").each(function(){$(this).appendTo(t)}),e.appendTo(t).addClass("bw-button-group"),$(document.createElement("div")).attr("id","menubutton").addClass("bw-toolbutton").append($(document.createElement("div")).addClass("bw-icon bw-icon-menu")).makeButton(tr("Menu")).tapOrClick(function(){$("#top-container").hasClass("bw-show-popup-menu")?hidePopupMenu():setTimeout(function(){$("#top-container").addClass("bw-show-popup-menu");var e=$(document.createElement("div")).addClass("bw-menu-overlay").appendTo("#container");setTimeout(function(){e.on("click touchend",function(){setTimeout(hidePopupMenu,500)})},350),$("#title-toolbar").appendTo(e)},100)}).appendTo(t)}}}function createTitleLayout(e,t,n){var o=$(e),r=$(document.createElement("div")).attr("id","container").prependTo(o).addClass("top-bottom-layout"),i=$(document.createElement("div")).attr("id","top-container").appendTo(r).addClass("top-container"),a=$(document.createElement("div")).appendTo(i).addClass("titlebar-layout");return $(document.createElement("div")).addClass("closebutton-container").appendTo(a),$(document.createElement("div")).addClass("title-container").append($(document.createElement("span")).attr("id","title")).appendTo(a),n?$(n).addClass("bw-toolbar").appendTo(a):$(document.createElement("div")).attr("id","title-toolbar").addClass("bw-toolbar").appendTo(a),createPopupToolbarIfRequired(),$(t).appendTo(r).addClass("bottom-container"),centerWidgetTitle(),r}function prependToTitleToolbar(e){var t=$("#title-toolbar");e.prependTo(t),createPopupToolbarIfRequired(),centerWidgetTitle()}function openDebugWindow(){var debugwindow=$(document.createElement("div")).addClass("bw-debug-window bw-row-container").appendTo("body"),debugoutput=$(document.createElement("div")).addClass("bw-debug-output bw-row-resizing").appendTo(debugwindow);function appendOutput(e){e.appendTo(debugoutput),debugoutput[0].scrollTop=debugoutput[0].scrollHeight-debugoutput[0].getBoundingClientRect().height}function argsToString(e){for(var t=[],n=0;n<e.length;++n)t.push(JSON.stringify(e[n]));return t.join(" ")}$(document.createElement("div")).addClass("bw-debug-close").text("X").tapOrClick(function(){debugwindow.remove(),localStorage.removeItem("bw-debug-enabled")}).appendTo(debugwindow),console.log=function(){appendOutput($(document.createElement("p")).safeHtml(argsToString(arguments)))},console.error=function(e,t){appendOutput($(document.createElement("p")).css("color","red").safeHtml(argsToString(arguments)))},window.onerror=function(e,t,n){return appendOutput($(document.createElement("p")).attr("style","color: red").safeHtml(e+" ("+t+":"+n+")")),!0},console.log(platform.getPlatform(),navigator.platform,navigator.userAgent,window.innerWidth,window.innerHeight);var debuginput=$(document.createElement("input")).addClass("bw-debug-input bw-row-fixed").appendTo(debugwindow),commandlist=[],index=0;function exec(str){var goodstr=str.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"');console.log(eval(goodstr)),commandlist.push(goodstr),index=commandlist.length}debuginput.keypress(function(e){13===(e.keyCode?e.keyCode:e.which)&&(exec(debuginput.val()),debuginput.val(""))}),debuginput.keydown(function(e){var t=e.keyCode?e.keyCode:e.which;38===t?index>0&&(--index,debuginput.val(commandlist[index])):40===t&&index<commandlist.length&&(++index===commandlist.length?debuginput.val(""):debuginput.val(commandlist[index]))});try{debugwindow.draggable()}catch(e){console.error("No drag support")}}function showDebugDialog(){if(!($(".bw-debug-window").length>0)){var e=$(document.createElement("div")).addClass("bw-debug-wrapper").appendTo("body"),t=$(document.createElement("div")).addClass("bw-debug-dialog").appendTo(e);$(document.createElement("p")).text("Enter your support key:").appendTo(t);var n=$(document.createElement("input")).attr("placeholder","key").appendTo(t);$(document.createElement("br")).appendTo(t),$(document.createElement("button")).attr("type","button").text("Cancel").tapOrClick(function(){e.remove()}).appendTo(t),$(document.createElement("button")).attr("type","button").text("OK").tapOrClick(function(){"bw-magic"===n.val()&&(openDebugWindow(),e.remove(),localStorage.setItem("bw-debug-enabled","true"))}).appendTo(t)}}function initializeDebugSupport(e){var t=0;e.clickOrHold(function(){t=0},function(){3==++t&&(showDebugDialog(),t=0)},2e3);try{"true"===localStorage.getItem("bw-debug-enabled")&&openDebugWindow()}catch(e){}}function enableOsxIbooksHack(){if("ibw-platform-osx-ibooks"===platform.getPlatform()){var e=["html.ibw-platform-osx-ibooks, .ibw-platform-osx-ibooks .bw-popup-zoomable-image {","width: "+window.innerWidth+"px;","height: "+window.innerHeight+"px;","}"],t=document.createElement("style");t.id="osx_ibooks_workaround",t.type="text/css",t.appendChild(document.createTextNode(e.join("\n"))),document.head.appendChild(t)}}function makeWidget(e){e=e||{},enableOsxIbooksHack();var t=$("body");t.addClass("bw"),e.hasOwnProperty("no-user-select")&&!0===e["no-user-select"]&&t.addClass("no-user-select");var n,o=e.layout||"";if("title_layout"===o?(n=createTitleLayout("body","#bottom-container")).find(".top-container").addClass("title-only"):"title_overlay_layout"===o?((n=createTitleLayout("body","#bottom-container")).addClass("title-overlay"),n.find(".top-container").addClass("title-only")):n="title_toolbar_layout"===o?createTitleLayout("body","#bottom-container","#title-toolbar"):$("#container"),e.hasOwnProperty("title")&&""!==e.title){var r=n.find("#title");r.safeHtml(e.title),initializeDebugSupport(r)}else{var i=n.find(".top-container");i.addClass("title-empty"),initializeDebugSupport(i)}"ibw-platform-ipad-ibooks-epub"===platform.getPlatform()&&(e.hasOwnProperty("epubBlockTouchEndCheck")||(e.epubBlockTouchEndCheck=function(e){return e.srcElement instanceof SVGElement||$(e.srcElement).hasClass("epub-block")}),document.addEventListener("touchend",function(t){var n=$(window).width();(t.layerX<50||n-t.layerX<50||e.epubBlockTouchEndCheck(t))&&t.preventDefault()},!1),e.hasOwnProperty("epubBlockTouchStartCheck")&&document.addEventListener("touchstart",function(t){e.epubBlockTouchStartCheck(t)&&t.preventDefault()},!1)),ShowBacklinkIfRequired()}function getRoot(){return platform.isWebPreview()?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/",window.location.pathname.lastIndexOf("/")-1)):""}return $(function(){var e=platform.getPlatform(),t=$("html");t.hasClass("ibw-platform-custom")||t.addClass(e)}),window.custom_alert=dialog.showAlert,window.criticalAlert=dialog.showCriticalAlert,window.bw_confirmation_dialog=dialog.showConfirmationDialog,window.tr=tr,window.getUrlParams=qs.getUrlParams,window.getNakedURL=getNakedURL,window.setQueryParameters=setQueryParameters,window.createLabeledCheckbox=uiComponents.createLabeledCheckbox,window.createProgressBar=uiComponents.createProgressBar,window.createSimpleCheckbox=uiComponents.createSimpleCheckbox,window.createNumberButtons=uiComponents.createNumberButtons,window.createSimpleRadiobutton=uiComponents.createSimpleRadiobutton,window.createLabeledRadiobutton=uiComponents.createLabeledRadiobutton,window.createProgressCircle=uiComponents.createProgressCircle,window.URIEncodeImage=uriEncodeImage,window.BWAdaptToPageProtocol=adaptToPageProtocol,window.updateConfigCSS=bwTool.updateConfigCSS,{makeWidget:makeWidget,getNakedURL:getNakedURL,setQueryParameters:setQueryParameters,prependToTitleToolbar:prependToTitleToolbar,centerTitle:centerWidgetTitle,ShowBacklinkIfRequired:ShowBacklinkIfRequired,getRoot:getRoot}}(__webpack_require__(2),__webpack_require__(5),__webpack_require__(275),__webpack_require__(276),__webpack_require__(13),__webpack_require__(6),__webpack_require__(0),__webpack_require__(277),__webpack_require__(278),__webpack_require__(72),__webpack_require__(279),__webpack_require__(280))},5:function(e,t){e.exports=function(){var e=["context_id","course_id","hide_account","lfq","lti","login_hint","no_logout","q","sso","smartschool_platform","student_class_id","submit_url","teacher_email","teacher_id"];function t(e){var t=[];if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;++n){var o=e[n];o.length>1?t.push(encodeURIComponent(o[0])+"="+encodeURIComponent(o[1])):t.push(encodeURIComponent(o[0]))}else for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}function n(e){for(var t={},n=e.split("&"),o=0;o<n.length;o++){var r=n[o].indexOf("=");if(!(r<0)){var i=[n[o].substr(0,r),n[o].substr(r+1)],a=decodeURIComponent(i[0]);if(void 0===t[a])t[a]=decodeURIComponent(i[1]);else if("string"==typeof t[a]){var s=[t[a],decodeURIComponent(i[1])];t[a]=s}else t[a].push(decodeURIComponent(i[1]))}}return t}function o(e){for(var t=[],n=e.split("&"),o=0;o<n.length;o++){var r=n[o].indexOf("=");if(r<0)t.push([n[o]]);else{var i=[n[o].substr(0,r),n[o].substr(r+1)];t.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])])}}return t}function r(e){return!e||e.length<1||"?"!==e[0]?{}:n(e.substr(1))}function i(e){return!e||e.length<1||"?"!==e[0]?[]:o(e.substr(1))}function a(e,t){return e.split("&").filter(function(e){return decodeURIComponent(e.split("=")[0])!==t}).join("&")}function s(e){return(e=e||window.location.href).indexOf("#")>=0?"#"+(e.split("#")[1]||""):""}!function(){var n=i(window.location.search),r=[],a=s();if(a.length>=1&&"#"===a[0])for(var l=o(a.substr(1)),c=0;c<l.length;++c){var d=l[c];e.indexOf(d[0])>=0?n.push(d):r.push(d)}var u=window.location.pathname;n.length>0&&(u+="?"+t(n)),r.length>0&&(u+="#"+t(r)),"undefined"!=typeof history&&history.replaceState("",document.title,u)}();var l=s(),c=window.location.search;return{split:n,splitList:o,getUrlParams:function(e){return-1===e.indexOf("?")?{}:n(e.replace(/[^\?]*\?/,"").replace(/#.*/,""))},getQueryParams:r,getParameters:function(){var e=r(c),t=function(e){return!e||e.length<1||"#"!==e[0]?{}:n(e.substr(1))}(l);for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e},removeQueryStringParameter:function(e,t){return e.length>0&&("?"===e[0]||"#"===e[0])?e[0]+a(e.substring(1),t):a(e,t)},updateWindowQueryParameter:function(e,n){for(var o=i(window.location.search),r=!1,a=0;a<o.length;++a)if(o[a][0]===e){o[a].length>1?o[a][1]=n:o[a].push(n),r=!0;break}r||o.push([e,n]),history.replaceState("",document.title,window.location.pathname+"?"+t(o)+s())},urlencode:t,getHash:s,LEGACY_HASH_PARAMETERS:e}}()},6:function(e,t,n){e.exports=(n(4),function(e){try{return window.bwlocalizationmap&&window.bwlocalizationmap[e]&&""!==window.bwlocalizationmap[e]?window.bwlocalizationmap[e]:e}catch(t){return e}})},70:function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r,i,a;e.exports=(r=n(12).createLogger("CallbackBridge"),i=1,(a=function(){this.id=i++,this.listening=!1,this.nextCallbackID=1,this.callbacks={},this.handleMessage=this._handleMessage.bind(this)}).prototype.getMessagePrefix=function(){return"bw-CBBridge-"+this.id+"-"},a.prototype.startListening=function(){window.addEventListener("message",this.handleMessage)},a.prototype.stopListening=function(){window.removeEventListener("message",this.handleMessage)},a.prototype._handleMessage=function(e){var t=this.getMessagePrefix();"object"===o(e.data)&&"string"==typeof e.data.command&&e.data.command.substr(0,t.length)===t&&(e.data.hasOwnProperty("err")?this.processCallback(e.data.command,e.data.err,e.data.data):this.processCallback(e.data.command,e.data.arg))},a.prototype.registerCallbacks=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={ok:e,error:t},{ok:this.getMessagePrefix()+n+"-ok",error:this.getMessagePrefix()+n+"-error"}},a.prototype.registerCallback=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={cb:e,singleshot:!t},this.getMessagePrefix()+n+"-cb"},a.prototype.processCallback=function(e,t,n){try{var o=e.match(/bw-CBBridge-.*-(.*)-(ok|error|cb)$/);if(o){var i,a=o[1],s=this.callbacks[a];return s?"cb"===o[2]?((i=s.cb)(t,n),void(s.singleshot&&delete this.callbacks[a])):(i="ok"===o[2]?s.ok:s.error,delete this.callbacks[a],void i(t)):void r.error("Cannot find callback with ID "+a+" Bridge "+this.id+this.callbacks)}r.error("Malformed callback: "+e)}catch(e){r.error(e)}},a)},71:function(e,t,n){var o,r,i;e.exports=(o=n(5),r=o.getParameters(),i=!!r.lti_authenticated,{isLTI:function(){return!!r.lti||!!r.lti_version},isEmbeddedLTI:function(){return!!r.lti_version},isEmbeddedLTIAuthenticated:function(){return i},setEmbeddedLTIAuthenticated:function(){i=!0,o.updateWindowQueryParameter("lti_authenticated","1")}})},72:function(e,t){e.exports=function(){var e=[];function t(){for(var t=0;t<e.length;++t)e[t]()}return{executeCssUpdateCallbacks:t,CssUpdateCallbacks:e,updateConfigCSS:function(e){for(var n=document.getElementsByTagName("link"),o=0,r=n.length;o<r;o++){var i=n[o],a=i.rel;if("string"!=typeof a||0===a.length||"stylesheet"===a){var s=i.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(i.setAttribute("href","config"+e+".css"),setTimeout(t,100))}}},addAllDesignInfo:function(){void 0!==window.addAllDesignInfo&&window.addAllDesignInfo()},addCSSUpdateCallback:function(t){e.push(t)}}}()},73:function(e,t,n){e.exports=function(e){var t={},n=null,o=[];function r(){0!=o.length?(n=o.shift())():n=null}return t.pushAsyncFunc=function(t){var i=e.Deferred();return o.push(function(){t().always(function(){i.resolve(),r()})}),null===n&&r(),i},t.pushSyncFunc=function(t){this.pushAsyncFunc(function(){return t(),e.when()})},t}(n(0))},74:function(e,t,n){var o=function(e,t,o,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(283),a=!1;function s(t){var n=o.Deferred();return i.remove(t,function(t){return null===t||t.code==e.BWDS_ERROR_UNKNOWN?n.resolve():(console.log("Remove failed: "+JSON.stringify(t)),n.reject()),n}),n}function l(n,s,l){var c=o.Deferred();return i.write(n,s,function(n){if(null===n)c.resolve();else{if(l&&!1===a){if(n.code==e.BWDS_ERROR_SECURITY){var o=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===o||"ibw-platform-ipad-ibooks"===o?r.showCriticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+o.getIOSIBooksRestartInfo(),"Storage error"):r.showCriticalAlert("Storing answers not supported on this platform.","Storage error")}else r.showCriticalAlert("Could not save your answer.","Storage problem");a=!0}console.log("Save failed"),c.reject()}}),c}function c(n,s){var l=o.Deferred();return i.read(n,function(n,o){if(null===n)o?l.resolve(o):(console.log("How did this happen?  No saved data on read!"),l.reject({}));else{if(s&&!1===a)if(n.code==e.BWDS_ERROR_SECURITY){var i=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===i||"ibw-platform-ipad-ibooks"===i?r.showCriticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+i.getIOSIBooksRestartInfo(),"Storage error"):r.showCriticalAlert("Storing answers not supported on this platform.","Storage error"),a=!0}else n.code!=e.BWDS_ERROR_UNKNOWN&&(console.log("Error "+n.code+" occurred while loading data: "+n.message),r.showCriticalAlert("Storing answers not supported on this platform.","Storage error"),a=!0);l.reject({})}}),l}function d(e,t){var n=e||{};for(var o in t){var r=t[o];null===r?delete n[o]:n[o]=r}return n}return{createWidgetStorage:function(e,t,n,r,a,u,f){var g={},p=""==a?"":a+"/";function h(){return p+"books/"+e+"/"+t+"/"+n}var m={};function v(e){return h()+"/img/"+e}return g.loadAll=function(e){var t,n;r?c(h()+u,f).done(e).fail(function(){e(null)}):""!==a?c(h(),f).always(function(t){try{var n=JSON.parse(t);m=n,e(JSON.parse(t))}catch(t){console.log("Can't parse bwds user data"),console.log(t),e(m)}}):(t=h(),n=o.Deferred(),i.dir(t,function(e,t){null===e?n.resolve(t):n.reject(e)}),n).done(function(t){var n={},r=[];function a(e,t,o){i.read(e+"/"+t,function(e,r){null===e?n[t]=r:console.log("Received error reading: "+t),o.resolve()})}for(var s=0;s<t.length;++s){var l=o.Deferred();r.push(l),a(h(),t[s],l)}o.when.apply(null,r).done(function(){e(n)})}).fail(function(t){e({})})},g.write=function(e,t){if(r)null===e?s(h()+u).always(t):l(h()+u,e,f).always(t);else if(""!==a)m=d(m,e),l(h(),JSON.stringify(m),f).always(t);else{var n=[];for(var i in e){var c=e[i];null===c?n.push(s(h()+"/"+i)):n.push(l(h()+"/"+i,c,f))}o.when.apply(null,n).always(t)}},g.overwriteAndSetVersion=function(e,t){var n=o.Deferred();if(r)null===e?s(h()+u).always(function(){n.resolve()}):l(h()+u,e,f).always(function(){g.setVersion(t).always(function(){n.resolve()})});else if(""!==a){var i=JSON.stringify(e);m=JSON.parse(i),l(h(),i,f).always(function(){g.setVersion(t).always(function(){n.resolve()})})}else console.error("bwds_storage_if.overwriteAndSetVersion not implemented for this storage mode... only intended for local caching"),n.reject();return n},g.setVersion=function(e){var t=o.Deferred(),n=h();return r&&(n+=u),i.stat(n,function(o,r,a){null===o?i.setStat(n,{backup_date:r.modified,backup_version:e},function(e){null===e?t.resolve():(console.log("Problem writing stat: "+JSON.stringify(e)),t.reject())}):(console.log("Got error reading stat for "+n+": means offline mode won't work"),t.reject())}),t},g.getVersion=function(e){var t=h();r&&(t+=u),i.stat(t,function(t,n,o){null===t?e({version:n.backup_version,offlinedata:n.backup_date!=n.modified,hasdata:!0}):(console.log("Error reading stat... assume there is no data"),e({version:0,offlinedata:!1,hasdata:!1}))})},g.writeImage=function(e,t){return l(v(e),t,f)},g.clearImage=function(e){return s(v(e))},g.isImageBackedUp=function(e){var t=o.Deferred();return i.stat(v(e),function(e,n,o){null===e?t.resolve(n.backup_date==n.modified):t.reject()}),t},g.listImagesAndBackupStatus=function(){var e=o.Deferred();return i.stat(h()+"/img",function(t,n,o){if(null===t){for(var r=[],i=0;i<o.length;++i){var a=o[i].name;r.push({id:a.substring(a.lastIndexOf("/")+1),backed_up:o[i].backup_date===o[i].modified})}e.resolve(r)}else e.resolve([])}),e},g.setImageBackedUp=function(e){var t=o.Deferred();return i.stat(v(e),function(n,o,r){null===n?i.setStat(v(e),{backup_date:o.modified},function(e){null===e?t.resolve():t.reject()}):t.reject()}),t},g.readImage=function(e){return c(v(e),f)},g.sync=function(e){i.executeSync(e)},g},createInfoStorage:function(e,t,n){var o={},r={},i={};function a(e){return(""==t?"":t+"/")+"info/"+e}return c(a("BWCommon"),n).always(function(e){try{r=JSON.parse(e)}catch(e){r={}}}),c(a(e),n).always(function(e){try{i=JSON.parse(e)}catch(e){i={}}}),o.getCommonProperties=function(e){e(r)},o.getGroupProperties=function(e){e(i)},o.setCommonProperties=function(e){r=d(r,e),l(a("BWCommon"),JSON.stringify(r),n)},o.setGroupProperties=function(t){i=d(i,t),l(a(e),JSON.stringify(i),n)},o}}}.bind(null,n(32),n(2),n(0),n(13));e.exports={f:o,o:o()}}});